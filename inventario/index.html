<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Arcano 33 · Inventario</title>
  <meta name="description" content="Inventario interno de insumos, botellas y producto terminado de Arcano 33." />
  <meta name="theme-color" content="#7b1818" />

  <link rel="icon" type="image/png" sizes="192x192" href="images/logo.png" />
  <link rel="apple-touch-icon" href="images/logo.png" />
  <link rel="manifest" href="manifest.webmanifest?v=4.20.77&r=1" />

  <link rel="stylesheet" href="style.css?v=4.20.77&r=1" />
  <link rel="stylesheet" href="/assets/css/a33-header.css?v=4.20.77&r=1" />
</head>
<body>
  <header class="a33-header" role="banner">
    <a class="a33-btn-menu" href="../index.html" aria-label="Volver al Menú principal">← Menú principal</a>
    <div class="a33-title">Inventario</div>
    <div class="a33-version" data-a33-version="1" data-a33-fallback="v4.20.77">v...</div>
  </header>
  <main class="app-main">
    <section class="card form-card inv-span-2">
      <h2>Inventario de materia prima líquida</h2>
      <p class="hint">Control en mililitros de los líquidos base que se utilizan en las recetas y producción.</p>
      <div class="table-wrapper">
        <table class="inv-table has-actions">
          <thead>
            <tr>
              <th>Ingrediente</th>
              <th>Stock actual (ml)</th>
              <th>Stock máximo (ml)</th>
              <th>% restante</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="inv-liquidos-body">
            <!-- Filas dinámicas -->
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <div id="inv-liquidos-empty" class="empty-state" hidden>Sin resultados.</div>
        <button id="inv-liquidos-more" class="btn-secondary btn-pill" type="button" hidden>Cargar más</button>
      </div>
      <p class="legend">
        Alerta cuando un ingrediente esté por debajo del <strong>20&nbsp;%</strong> de su stock máximo configurado.
      </p>
    </section>

    <section class="card table-card">
      <h2>Inventario de botellas por presentación</h2>
      <p class="hint">Control de unidades de botellas por presentación (vacías listas para producción).</p>
      <div class="table-wrapper">
        <table class="inv-table has-actions">
          <thead>
            <tr>
              <th>Presentación</th>
              <th>Stock actual (unid.)</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="inv-botellas-body">
            <!-- Filas dinámicas -->
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <div id="inv-botellas-empty" class="empty-state" hidden>Sin resultados.</div>
        <button id="inv-botellas-more" class="btn-secondary btn-pill" type="button" hidden>Cargar más</button>
      </div>
      <p class="legend">
        Alerta cuando una presentación tenga <strong>10 botellas o menos</strong> en inventario.
      </p>
    </section>

    <section class="card table-card">
      <h2>Tapas (Auto)</h2>
      <p class="hint">Control de tapas por grupo de presentaciones. Ajusta stock y mínimo; el estado se actualiza en tiempo real.</p>
      <div class="table-wrapper">
        <table class="inv-table has-actions">
          <thead>
            <tr>
              <th>Tipo</th>
              <th>Stock (unid.)</th>
              <th>Mínimo</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="inv-caps-body">
            <!-- Filas fijas (Tapas Auto) -->
          </tbody>
        </table>
      </div>

      <p class="legend">
        Semáforo: <strong>Sin stock</strong> (stock &le; 0), <strong>Bajo</strong> (stock &le; mínimo), <strong>OK</strong>.
      </p>
    </section>
  
    <section class="card table-card">
      <div class="table-header">
        <div>
          <h2>Inventario Varios</h2>
          <p class="hint">Consumibles y otros insumos manuales (vasos, guantes, tapas extra, etc.).</p>
        </div>
        <div class="table-actions">
          <input id="inv-varios-search" class="varios-search" type="text" inputmode="search" autocomplete="off" placeholder="Buscar…" aria-label="Buscar en inventario varios" />
          <button id="inv-varios-add" class="btn secondary" type="button">Agregar línea</button>
        </div>
      </div>

      <div class="table-wrapper">
        <table class="inv-table inv-varios-table">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Stock</th>
              <th>Mínimo</th>
              <th>Estado</th>
              <th>Eliminar</th>
            </tr>
          </thead>
          <tbody id="inv-varios-body">
            <!-- Filas dinámicas (Varios) -->
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <div id="inv-varios-empty" class="empty-state" hidden>Sin líneas. Agrega una para comenzar.</div>
      </div>

      <p class="legend">
        Semáforo: <strong>Sin stock</strong> (stock &le; 0), <strong>Bajo</strong> (stock &le; mínimo), <strong>OK</strong>. Stock negativo permitido.
      </p>
    </section>

    <section class="card table-card">
      <h2>Inventario de producto terminado</h2>
      <p class="hint">Botellas listas de Sangría Artesanal Premium por presentación. Este inventario se actualiza automáticamente desde la Calculadora de Producción y el POS.</p>
      <div class="table-wrapper">
        <table class="inv-table">
          <thead>
            <tr>
              <th>Presentación</th>
              <th>Stock actual (unid.)</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody id="inv-productos-body">
            <!-- Filas dinámicas de producto terminado -->
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <div id="inv-productos-empty" class="empty-state" hidden>Sin resultados.</div>
        <button id="inv-productos-more" class="btn-secondary btn-pill" type="button" hidden>Cargar más</button>
      </div>
      <p class="legend">
        Este bloque es solo de consulta. Se alimenta de la producción registrada y de las ventas / devoluciones del POS.
      </p>
    </section>
</main>

  <footer class="app-footer">
    <p>Arcano 33 · Inventario interno de insumos, botellas y producto terminado</p>
  </footer>

  <!-- A33 — Modal numérico (Líquidos) -->
  <div id="a33-modal-cantidad" class="a33-modal" hidden aria-hidden="true">
    <div class="a33-modal-card" role="dialog" aria-modal="true" aria-labelledby="a33-modal-cantidad-title">
      <div id="a33-modal-cantidad-title" class="a33-modal-title">Cantidad</div>
      <div id="a33-modal-cantidad-text" class="a33-modal-text"></div>

      <label class="a33-modal-field" for="a33-modal-cantidad-input">
        <span class="a33-modal-label">Cantidad</span>
        <input
          id="a33-modal-cantidad-input"
          class="a33-modal-input"
          type="number"
          inputmode="decimal"
          step="0.01"
          min="0"
          autocomplete="off"
          placeholder=""
        />
      </label>

      <div class="a33-modal-actions">
        <button id="a33-modal-cantidad-cancel" class="btn secondary btn-pill" type="button">Cancelar</button>
        <button id="a33-modal-cantidad-ok" class="btn primary btn-pill" type="button">OK</button>
      </div>
    </div>
  </div>
  <script src="/assets/js/a33-release.js?v=4.20.77&r=1"></script>


  <script src="/assets/js/a33-storage.js?v=4.20.77&r=1"></script>
  <script src="/assets/js/a33-presentations.js?v=4.20.77&r=1"></script>
  <script src="/assets/js/a33-auth.js?v=4.20.77&r=1"></script>
  <script>
    (async () => {
      // Guard robusto (mala señal / offline): evita loops y fallbacks raros.
      try{
        if (!window.A33Auth) return;

        if (typeof A33Auth.ensureMigrated === 'function'){
          try{ await A33Auth.ensureMigrated(); }catch(_){ }
        }

        const authed = (typeof A33Auth.isConfigured === 'function' && typeof A33Auth.isAuthenticated === 'function')
          ? (A33Auth.isConfigured() && A33Auth.isAuthenticated())
          : false;
        if (authed) return;

        const looksOffline = async () => {
          try{
            if (typeof navigator !== 'undefined' && navigator.onLine === false) return true;
            const ctrl = ('AbortController' in window) ? new AbortController() : null;
            const t = ctrl ? setTimeout(() => { try{ ctrl.abort(); }catch(_){ } }, 2500) : null;
            await fetch('../index.html', { method: 'HEAD', cache: 'no-store', signal: ctrl ? ctrl.signal : undefined });
            if (t) clearTimeout(t);
            return false;
          }catch(_){ return true; }
        };

        if (await looksOffline()){
          try{ location.replace('./offline.html?reason=auth'); }catch(_){ }
          return;
        }

        if (typeof A33Auth.requireAuth === 'function'){
          await A33Auth.requireAuth({ redirectTo: '../index.html' });
        }else{
          location.href = '../index.html';
        }
      }catch(_){
        try{ location.replace('../index.html'); }catch(__){ }
      }
    })();
  </script>
  <script src="script.js?v=4.20.77&r=1"></script>
  <script src="/assets/js/a33-input-ux.js?v=4.20.77&r=1"></script>
</body>
</html>
