<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>A33 POS</title>
<link rel="manifest" href="manifest.webmanifest?v=4.20.5">
<link rel="apple-touch-icon" href="logo.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f0f0f"/>
<link rel="stylesheet" href="styles.css?v=4.20.5">
  <link rel="stylesheet" href="/assets/css/a33-header.css" />
</head>
<body>
  <header class="a33-header" role="banner">
    <a class="a33-btn-menu" href="../index.html" aria-label="Volver al Menú principal">← Menú principal</a>
    <div class="a33-title">POS · Eventos</div>
    <div class="a33-version">v4.20.5</div>
  </header>
<div id="offlineBar" class="offline">Trabajando sin conexión</div>
<div class="container">

  <section id="tab-venta" class="tab card">
    <h2>Vender</h2>

    <div id="sell-day-closed-banner" class="warn a33-guard-banner" style="display:none">
      <div class="a33-guard-text">
        <div class="a33-guard-title" id="sell-day-closed-title">Día cerrado</div>
        <div class="a33-guard-sub" id="sell-day-closed-sub">Para vender aquí, reabrí el día en Resumen.</div>
      </div>
      <div class="a33-guard-actions">
        <button id="btn-go-caja" class="btn-primary btn-pill" type="button">Ir a Resumen</button>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Evento activo</label>
        <div class="row">
          <select id="sale-event">
            <option value="">— Selecciona evento —</option>
          </select>
          <input id="new-event" placeholder="Nuevo evento">
        </div>

<div class="row">
  <label>Evento maestro / Grupo</label>
</div>
<div class="row">
  <select id="event-group-select">
    <option value="">— Selecciona grupo —</option>
    <option value="__new__">+ Crear nuevo grupo</option>
  </select>
  <input id="event-group-new" placeholder="Nombre de nuevo grupo" style="display:none">
</div>
<div class="actions">
  <button type="button" id="btn-manage-groups" class="btn-link">Gestionar grupos</button>
</div>
<small class="muted">Usa el mismo nombre de grupo para todos los días del mismo evento maestro. Puedes ocultar grupos antiguos desde “Gestionar grupos”.</small>

        <div class="actions">
  <button id="btn-add-event" class="btn-primary btn-pill">+ Crear y activar evento</button>
  <button id="btn-close-event" class="btn-warn btn-pill">Cerrar evento (Corte)</button>
  <button id="btn-reopen-event" class="btn-ok btn-pill">Reabrir evento</button>
</div>
	        <div class="row" style="grid-template-columns:1fr; align-items:center">
	          <div class="petty-toggle-wrap">
	            <span class="petty-toggle-title">Caja Chica</span>
	            <label class="switch" title="Activar / desactivar Caja Chica para este evento">
	              <input type="checkbox" id="pc-event-toggle">
	              <span class="slider"></span>
	            </label>
	            <span id="pc-event-toggle-text" class="muted"></span>
	          </div>
	        </div>
        <div id="event-status" class="info" style="display:none"></div>
        <div id="no-active-note" class="disabled-note" style="display:none">Sin evento activo. Crea o selecciona uno para comenzar.</div>
      </div>
      <div>
        <label>Fecha</label>
        <input id="sale-date" type="date">
      </div>
    </div>

    <div class="row" id="sell-block">
      <div>
        <label>Producto</label>
        <select id="sale-product"></select>
        <div id="product-chips" class="chips"></div>
      </div>
      <div>
        <label>Precio (C$)</label>
        <input id="sale-price" type="number" inputmode="decimal" step="0.01">
        <div><small class="muted">Stock: <span id="sale-stock">—</span></small></div>
      </div>
    </div>

    <div class="row4">
      <div>
        <label>Cantidad</label>
        <div class="stepper">
          <button id="qty-minus">−</button>
          <input id="sale-qty" type="number" inputmode="numeric" step="1" value="1" min="1">
          <button id="qty-plus">+</button>
        </div>
      </div>
      <div>
        <label>Descuento por unidad (C$)</label>
        <input id="sale-discount" class="a33-num" data-a33-default="0" type="number" inputmode="decimal" step="0.01" value="0">
      </div>
      <div>
        <label>Método de pago</label>
        <select id="sale-payment">
          <option value="efectivo" selected>Efectivo</option>
          <option value="transferencia">Transferencia</option>
          <option value="credito">Crédito</option>
        </select>
      </div>
      <div>
        <label>Total (C$)</label>
        <input id="sale-total" type="number" inputmode="decimal" step="0.01" disabled>
      </div>
    </div>


<!-- Cliente (opcional) · Clientes v2 -->
<div class="row" id="sale-customer-row">
  <div class="customer-v2">
    <div class="customer-v2-field">
      <label>Cliente</label>
      <input id="sale-customer" placeholder="Escribe cliente…">
    </div>

    <div class="customer-v2-actions">
      <button id="btn-pick-customer" class="btn-outline btn-pill btn-pill-mini" type="button">Seleccionar</button>
      <button id="btn-clear-customer" class="btn-outline btn-pill btn-pill-mini" type="button">Limpiar</button>
      <label class="flag customer-v2-sticky"><input id="sale-customer-sticky" type="checkbox"> Pegajoso</label>
      <button id="btn-toggle-customer-manage" class="btn-outline btn-pill btn-pill-mini" type="button" aria-expanded="false">Gestionar ▾</button>
    </div>
  </div>
</div>

<div id="customer-manage-panel" class="customer-manage" style="display:none">
  <div class="card inner">
    <h4 style="margin:0 0 10px 0">Clientes</h4>

    <div class="row" style="align-items:end">
      <div>
        <label>Agregar cliente (sin venta)</label>
        <input id="customer-add-name" placeholder="Nombre del cliente">
        <small id="customer-add-msg" class="muted"></small>
      </div>
      <div style="align-self:end">
        <label>&nbsp;</label>
        <button id="customer-add-save" class="btn-ok btn-pill btn-pill-mini" type="button">Guardar</button>
      </div>
    </div>


	    <div class="customer-manage-toolbar">
	      <div class="customer-manage-toolbar-top">
	        <div class="customer-manage-search">
	          <label>Buscar</label>
	          <input id="customer-manage-search" placeholder="Buscar cliente…">
	          <small id="customer-manage-count" class="muted"></small>
	        </div>
	        <div class="customer-manage-actions">
	          <div class="customer-manage-filters" role="group" aria-label="Filtro clientes">
	            <button id="customer-manage-filter-active" class="btn-outline btn-pill btn-pill-mini" type="button">Activos</button>
	            <button id="customer-manage-filter-all" class="btn-outline btn-pill btn-pill-mini" type="button">Todos</button>
	          </div>
	          <label class="flag customer-manage-compact-toggle"><input id="customer-manage-compact" type="checkbox"> Compacto</label>
	          <button id="customer-manage-collapse-all" class="btn-outline btn-pill btn-pill-mini" type="button" title="Colapsar letras">Colapsar</button>
	          <button id="customer-manage-expand-all" class="btn-outline btn-pill btn-pill-mini" type="button" title="Expandir letras">Expandir</button>
	        </div>
	      </div>
	    </div>

	    <div class="customer-manage-scroll">
	      <div id="customer-manage-list" class="customer-manage-list"></div>
	    </div>

    <div class="info"><small>Desactivar solo oculta del selector. Ventas históricas no se tocan.</small></div>
  </div>
</div>

    <div class="row" id="sale-bank-row" style="display:none">
      <div>
        <label>Banco (solo Transferencia)</label>
        <select id="sale-bank">
          <option value="">— Selecciona banco —</option>
        </select>
        <small id="sale-bank-note" class="muted"></small>
      </div>
    </div>

    <details class="card">
      <summary>Más opciones</summary>
      <div class="row">
        <div>
          <label class="flag"><input id="sale-courtesy" type="checkbox"> Cortesía</label>
          <label class="flag"><input id="sale-return" type="checkbox"> Devolución</label>
        </div>
        <div>
          <label>Cortesía a</label>
          <input id="sale-courtesy-to" placeholder="Nombre (si marcaste cortesía)" disabled>
        </div>
      </div>
      <label>Notas (opcional)</label>
      <textarea id="sale-notes" rows="2" placeholder="ej. promo, ref. de pago, etc."></textarea>
    </details>

    <div class="row">
      <button id="btn-add" class="btn-ok">+ Agregar venta</button>
      <button id="btn-undo" class="btn-warn">↩︎ Deshacer última</button>
    </div>

        <div class="vasos-panel">
      <button type="button" id="vasosPanelToggle" class="vasos-panel-toggle btn-pill" aria-expanded="false">
        <span class="vasos-panel-title">VASOS</span>
        <span class="vasos-panel-meta">
          <span class="vasos-panel-state">Mostrar</span>
          <span class="vasos-panel-caret" aria-hidden="true">▸</span>
        </span>
      </button>

      <div id="vasosPanelBody" class="vasos-panel-body is-collapsed" aria-hidden="true">
        <div class="vasos-panel-actions">
          <button type="button" id="vasosPanelCloseBtn" class="vasos-panel-close btn-mini">Cerrar</button>
        </div>

      <div class="card" id="cup-block">
            <h3>Venta por vaso</h3>
      
            <div class="row">
              <div><strong>Vasos disponibles: <span id="cup-available">0</span></strong></div>
              <div style="text-align:right"><strong>Galones fraccionados: <span id="cup-gallons">0</span></strong></div>
            </div>
      
            <div class="row3">
              <div>
                <label>Galones a fraccionar</label>
                <input id="cup-fraction-gallons" type="number" inputmode="numeric" step="1" min="1" value="1">
              </div>
              <div>
                <label>Vasos por galón</label>
                <input id="cup-yield" type="number" inputmode="numeric" step="1" min="1" value="22">
              </div>
              <div>
                <label>&nbsp;</label>
                <button id="btn-fraction" class="btn-primary btn-pill">Fraccionar</button>
              </div>
            </div>
      
            <div class="row3">
              <div>
                <label>Cantidad de vasos</label>
                <div class="stepper">
                  <button id="cup-qty-minus" type="button">−</button>
                  <input id="cup-qty" type="number" inputmode="numeric" step="1" min="1" value="1">
                  <button id="cup-qty-plus" type="button">+</button>
                </div>
              </div>
              <div>
                <label>Precio por vaso (C$)</label>
                <input id="cup-price" class="a33-num" data-a33-default="0" type="number" inputmode="decimal" step="0.01" min="0" value="0">
              </div>
              <div>
                <label>&nbsp;</label>
                <div class="row" style="grid-template-columns:1fr 1fr; gap:8px">
                  <button id="btn-sell-cups" class="btn-ok">Vender vasos</button>
                  <button id="btn-courtesy-cups" class="btn-warn">Registrar cortesía</button>
                </div>
              </div>
            </div>
      
            <div class="info" style="margin-top:10px">
              <div><b>Vasos creados:</b> <span id="cup-created">0</span> · <b>Vendidos:</b> <span id="cup-sold">0</span> · <b>Cortesía:</b> <span id="cup-courtesy">0</span> · <b>Restantes:</b> <span id="cup-remaining">0</span></div>
              <div><b>Remanente exacto:</b> <span id="cup-remnant">0</span> ml</div>
            </div>
      
            <small class="muted">Nota: esto controla porciones vendibles (vasos de sangría). No es inventario de vasos plásticos.</small>
          </div>
      </div>
    </div>


    <div class="card">
      <div class="row">
        <div><strong>Listado del día</strong></div>
        <div style="text-align:right"><strong>Total día: C$ <span id="day-total">0</span></strong></div>
      </div>
      <div class="table-scroll">
      <table id="tbl-day" class="compact">
        <thead>
          <tr>
            <th>Hora</th><th>Producto</th><th>Cant.</th><th>PU</th><th>Desc</th><th>Total</th><th>Pago</th><th>C</th><th>Dev</th><th>Cliente</th><th>Cortesía a</th><th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      </div>
    </div>
  </section>

  <section id="tab-inventario" class="tab card" style="display:none">
    <h2>Inventario por evento</h2>
    <div class="row">
      <div>
        <label>Evento</label>
        <select id="inv-event"></select>
      </div>
      <div class="actions end">
  <button id="btn-inv-csv" class="btn-primary btn-pill">CSV Inventario</button>
  <button id="btn-inv-ref" class="btn-ok btn-pill">Actualizar</button>
  <button id="btn-inv-from-lote" class="btn-ok btn-pill" type="button">Agregar desde lote</button>
</div>
    </div>
    <div id="lotes-evento-block" class="lotes-block">
      <div class="lotes-block-head">
        <div>
          <h3 style="margin:0">Lotes cargados en este evento <span class="badge" id="lotes-count">0</span></h3>
          <small class="muted">Se registra cuando usas “Agregar desde lote”.</small>
        </div>
        <div class="actions end">
          <button id="btn-reverse-assign" class="btn-outline btn-pill btn-pill-mini" type="button">Reversar asignación</button>
          <button id="btn-create-sobrante" class="btn-outline btn-pill btn-pill-mini" type="button">Crear lote sobrante</button>
        </div>
      </div>

      <div id="sobrante-panel" class="sobrante-panel" style="display:none">
        <div class="sobrante-panel-head">
          <div>
            <div class="sobrante-title">Sobrantes → Lote hijo</div>
            <small class="muted" id="sobrante-hint">Crea un lote DISPONIBLE y cierra el lote original (trazabilidad incluida).</small>
          </div>
          <div class="actions end">
            <button id="btn-sobrante-cancel" class="btn-outline btn-pill btn-pill-mini" type="button">Cancelar</button>
          </div>
        </div>

        <div class="row" style="grid-template-columns:1fr">
          <div>
            <label>Lote original</label>
            <select id="sobrante-lote-select"></select>
            <small class="muted" id="sobrante-lote-meta"></small>
          </div>
        </div>

        <div class="sobrante-grid" aria-label="Cantidades sobrantes por presentación">
          <div class="sobrante-cell"><label>P</label><input id="sobrante-p" type="number" inputmode="numeric" step="1" min="0" value="0"></div>
          <div class="sobrante-cell"><label>M</label><input id="sobrante-m" type="number" inputmode="numeric" step="1" min="0" value="0"></div>
          <div class="sobrante-cell"><label>D</label><input id="sobrante-d" type="number" inputmode="numeric" step="1" min="0" value="0"></div>
          <div class="sobrante-cell"><label>L</label><input id="sobrante-l" type="number" inputmode="numeric" step="1" min="0" value="0"></div>
          <div class="sobrante-cell"><label>G</label><input id="sobrante-g" type="number" inputmode="numeric" step="1" min="0" value="0"></div>
        </div>

        <div class="actions end">
          <button id="btn-sobrante-create" class="btn-ok btn-pill btn-pill-mini" type="button">Crear lote sobrante</button>
        </div>
      </div>

      <div id="reverso-panel" class="reverso-panel" style="display:none">
        <div class="reverso-panel-head">
          <div>
            <div class="reverso-title">Reverso de asignación</div>
            <small class="muted">Devuelve el lote a DISPONIBLE sin borrar historia. Solo se permite si es seguro.</small>
          </div>
          <div class="actions end">
            <button id="btn-reverso-cancel" class="btn-outline btn-pill btn-pill-mini" type="button">Cancelar</button>
          </div>
        </div>

        <div class="row" style="grid-template-columns:1fr">
          <div>
            <label>Lote asignado</label>
            <select id="reverso-lote-select"></select>
            <small class="muted" id="reverso-lote-meta"></small>
          </div>
        </div>

        <div class="reverso-grid" aria-label="Resumen de unidades a reversar">
          <div class="reverso-cell"><label>P</label><span id="reverso-p">0</span></div>
          <div class="reverso-cell"><label>M</label><span id="reverso-m">0</span></div>
          <div class="reverso-cell"><label>D</label><span id="reverso-d">0</span></div>
          <div class="reverso-cell"><label>L</label><span id="reverso-l">0</span></div>
          <div class="reverso-cell"><label>G</label><span id="reverso-g">0</span></div>
        </div>

        <div class="warn"><small><b>Regla:</b> si el evento ya tuvo consumo/ventas de esas presentaciones (o fraccionamiento de galones), el reverso se bloquea para evitar inconsistencias.</small></div>

        <div class="actions end">
          <button id="btn-reverso-do" class="btn-danger btn-pill btn-pill-mini" type="button">Reversar asignación</button>
        </div>
      </div>

      <div class="table-scroll">
        <table id="tbl-lotes-evento" class="compact">
          <thead>
            <tr>
              <th>Código/Nombre</th>
              <th>Fecha/Hora</th>
              <th>P</th>
              <th>M</th>
              <th>D</th>
              <th>L</th>
              <th>G</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <table id="tbl-inv">
      <thead>
        <tr>
          <th>Producto</th><th>Activo</th><th>Manejar</th><th>Inicial</th><th>Reposición</th><th>Ajuste ±</th><th>Stock</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="info"><small>“Manejar” desactiva inventario para productos que no se controlan aquí. Inicial se guarda por evento. Reposición y Ajuste crean movimientos fechados. <b>Nota:</b> la <i>Venta por vaso</i> se gestiona en el bloque “Venta por vaso” (no aparece en este inventario).</small></div>
  </section>

  <section id="tab-eventos" class="tab card" style="display:none">
    <h2>Eventos e historial</h2>
    <div class="topbar">
      <select id="filtro-eventos">
        <option value="todos" selected>Mostrar: Todos</option>
        <option value="abiertos">Solo abiertos</option>
        <option value="cerrados">Solo cerrados</option>
      </select>
      <select id="filtro-grupo">
        <option value="">Grupos: Todos</option>
      </select>
      <button id="btn-exportar-eventos" class="btn-primary btn-pill">Exportar lista (Excel)</button>
      <button id="btn-exportar-evento-excel" class="btn-ok btn-pill">Exportar evento activo (Excel)</button>
    </div>
    <div class="table-scroll">
    <table id="tbl-eventos">
      <thead><tr><th>Evento</th><th>Grupo</th><th>Estado</th><th>Creado</th><th>Cerrado</th><th>Total</th><th>Acciones</th></tr></thead>
      <tbody></tbody>
    </table>
    </div>
    <div id="cierre-total-card" class="card inner">
      <h3>Cierre Total por grupo</h3>
      <p class="muted">Selecciona un grupo arriba y genera un corte consolidado de todos sus eventos diarios.</p>
      <div class="actions">
  <button id="btn-cierre-total" class="btn-ok btn-pill">Cierre Total del grupo</button>
  <button id="btn-cierre-total-excel" class="btn-primary btn-pill">Exportar Cierre Total (Excel)</button>
</div>
      <div id="cierre-total-resumen" class="summary"></div>
      <div id="cierre-total-presentaciones" class="table-wrapper"></div>
    </div>
    <div id="cierre-caja-card" class="card inner">
      <h3>Caja Chica · Cierre Total por grupo</h3>
      <p class="muted">Usa este resumen para ver la caja chica consolidada de todos los días del mismo evento maestro.</p>
      <div class="actions">
  <button id="btn-cierre-caja-grupo" class="btn-ok btn-pill">Cierre Caja Chica del grupo</button>
  <button id="btn-cierre-caja-excel" class="btn-primary btn-pill">Exportar Caja Chica (Excel)</button>
</div>
      <div id="cierre-caja-resumen" class="summary"></div>
      <div id="cierre-caja-eventos" class="table-wrapper"></div>
    </div>
  </section>

  
  <section id="tab-caja" class="tab card" style="display:none">
    <h2>Caja Chica</h2>

    <p><span id="pc-event-info" class="info-strong">Evento activo: —</span></p>
    <p id="pc-no-event-note" class="disabled-note" style="display:none">Activa un evento en la pestaña Vender para usar Caja Chica.</p>

    <div id="pc-disabled-banner" class="warn" style="display:none">
      Caja Chica está <b>desactivada</b> para este evento.
      <button id="pc-btn-activate" class="btn-ok btn-inline btn-pill" type="button">Activar Caja Chica</button>
    </div>
    <div class="row" id="pc-day-row">
      <div>
        <label>Día operativo</label>
        <input id="pc-day" type="date">
        <small class="muted">Caja Chica se guarda por día dentro del mismo evento (saldo inicial, movimientos y arqueo final).</small>
      </div>
      <div style="text-align:right">
        <label>&nbsp;</label>
        <button id="pc-btn-use-prev" class="btn-primary" type="button" style="display:none">Usar cierre anterior</button>
        <div id="pc-prev-note" class="muted" style="margin-top:6px"></div>
      </div>
    </div>

    <div class="row" id="pc-history-row">
      <div>
        <label>Histórico (cierres guardados · solo lectura)</label>
        <select id="pc-history-select">
          <option value="">— Ver un día cerrado —</option>
        </select>
        <small id="pc-history-hint" class="muted"></small>
      </div>
      <div style="text-align:right">
        <label>&nbsp;</label>
        <div class="pc-history-actions">
          <button id="pc-history-back" class="btn-warn btn-pill" type="button" style="display:none">Volver al día operativo</button>
          <button id="pc-history-use" class="btn-primary btn-pill" type="button" style="display:none">Usar este cierre como inicio</button>
        </div>
        <div id="pc-history-note" class="muted" style="margin-top:6px"></div>
      </div>
    </div>

    <div id="pc-history-banner" class="warn" style="display:none"></div>

    <div id="pc-main" class="pc-main">
      <div class="row petty-summary">
        <div class="card">
          <h3>Córdobas (C$)</h3>
          <table class="pc-table">
            <tbody>
              <tr><th>Saldo inicial</th><td>C$ <span id="pc-nio-inicial">0.00</span></td></tr>
              <tr><th>Entradas</th><td>C$ <span id="pc-nio-entradas">0.00</span></td></tr>
              <tr><th>Salidas</th><td>C$ <span id="pc-nio-salidas">0.00</span></td></tr>
              <tr><th>Ventas en efectivo</th><td>C$ <span id="pc-nio-ventas">0.00</span></td></tr>
              <tr><th>Saldo teórico</th><td>C$ <span id="pc-nio-teorico">0.00</span></td></tr>
              <tr><th>Saldo final contado</th><td>C$ <span id="pc-nio-final">—</span></td></tr>
              <tr><th>Diferencia</th><td>C$ <span id="pc-nio-diferencia">—</span></td></tr>
            </tbody>
          </table>
        </div>
        <div class="card">
          <h3>Dólares (US$)</h3>
          <table class="pc-table">
            <tbody>
              <tr><th>Saldo inicial</th><td>US$ <span id="pc-usd-inicial">0.00</span></td></tr>
              <tr><th>Entradas</th><td>US$ <span id="pc-usd-entradas">0.00</span></td></tr>
              <tr><th>Salidas</th><td>US$ <span id="pc-usd-salidas">0.00</span></td></tr>
              <tr><th>Saldo teórico</th><td>US$ <span id="pc-usd-teorico">0.00</span></td></tr>
              <tr><th>Saldo final contado</th><td>US$ <span id="pc-usd-final">—</span></td></tr>
              <tr><th>Diferencia</th><td>US$ <span id="pc-usd-diferencia">—</span></td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Bloque editable: se deshabilita completo cuando el día está cerrado o en vista histórica -->
      <fieldset id="pc-count-fieldset" class="pc-lock-fieldset">
      <div class="card petty-inicial">
        <h3>Saldo inicial</h3>
        <div class="row">
          <div class="petty-block">
            <h4>Córdobas (C$)</h4>
            <table class="pc-table" id="pc-table-nio">
              <thead>
                <tr><th>Denominación</th><th>Cantidad</th><th>Subtotal</th></tr>
              </thead>
              <tbody>
                <tr><td>C$ 1</td><td><input id="pc-nio-q-1" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-nio-sub-1">0.00</span></td></tr>
                <tr><td>C$ 5</td><td><input id="pc-nio-q-5" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-nio-sub-5">0.00</span></td></tr>
                <tr><td>C$ 10</td><td><input id="pc-nio-q-10" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-nio-sub-10">0.00</span></td></tr>
                <tr><td>C$ 20</td><td><input id="pc-nio-q-20" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-nio-sub-20">0.00</span></td></tr>
                <tr><td>C$ 50</td><td><input id="pc-nio-q-50" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-nio-sub-50">0.00</span></td></tr>
                <tr><td>C$ 100</td><td><input id="pc-nio-q-100" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-nio-sub-100">0.00</span></td></tr>
                <tr><td>C$ 200</td><td><input id="pc-nio-q-200" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-nio-sub-200">0.00</span></td></tr>
                <tr><td>C$ 500</td><td><input id="pc-nio-q-500" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-nio-sub-500">0.00</span></td></tr>
                <tr><td>C$ 1000</td><td><input id="pc-nio-q-1000" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-nio-sub-1000">0.00</span></td></tr>
              </tbody>
              <tfoot>
                <tr><td colspan="2">Total inicial C$</td><td>C$ <span id="pc-nio-total">0.00</span></td></tr>
              </tfoot>
            </table>
          </div>
          <div class="petty-block">
            <h4>Dólares (US$)</h4>
            <table class="pc-table" id="pc-table-usd">
              <thead>
                <tr><th>Denominación</th><th>Cantidad</th><th>Subtotal</th></tr>
              </thead>
              <tbody>
                <tr><td>US$ 1</td><td><input id="pc-usd-q-1" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-usd-sub-1">0.00</span></td></tr>
                <tr><td>US$ 5</td><td><input id="pc-usd-q-5" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-usd-sub-5">0.00</span></td></tr>
                <tr><td>US$ 10</td><td><input id="pc-usd-q-10" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-usd-sub-10">0.00</span></td></tr>
                <tr><td>US$ 20</td><td><input id="pc-usd-q-20" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-usd-sub-20">0.00</span></td></tr>
                <tr><td>US$ 50</td><td><input id="pc-usd-q-50" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-usd-sub-50">0.00</span></td></tr>
                <tr><td>US$ 100</td><td><input id="pc-usd-q-100" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-usd-sub-100">0.00</span></td></tr>
              </tbody>
              <tfoot>
                <tr><td colspan="2">Total inicial US$</td><td>US$ <span id="pc-usd-total">0.00</span></td></tr>
              </tfoot>
            </table>
          </div>
        </div>

        <div class="petty-sync-row">
          <span class="muted" style="font-size:0.85rem">Usar saldo inicial desde Finanzas</span>
          <label class="switch" title="Solo se aplica cuando tú lo activas y presionas Sincronizar">
            <input type="checkbox" id="pc-init-from-fin-toggle">
            <span class="slider"></span>
          </label>
          <button id="pc-init-from-fin-sync" class="btn-primary btn-pill btn-pill-mini" type="button" disabled>Sincronizar</button>
          <span id="pc-init-from-fin-status" class="muted" style="font-size:0.85rem"></span>
        </div>

        <div class="actions end">
  <button id="pc-btn-save-initial" class="btn-ok btn-pill" type="button">Guardar saldo inicial</button>
  <button id="pc-btn-clear-initial" class="btn-danger btn-pill" type="button">Limpiar</button>
</div>
      </div>

      <fieldset id="pc-mov-fieldset" class="pc-lock-fieldset">
      <div class="card petty-mov">
        <h3>Movimientos de Caja Chica</h3>
        <div class="row">
          <div class="col">
            <label for="pc-mov-date">Fecha</label>
            <input id="pc-mov-date" type="date">
          </div>
          <div class="col">
            <label for="pc-mov-type">Tipo</label>
            <select id="pc-mov-type">
              <option value="entrada">Ingreso</option>
              <option value="salida">Egreso</option>
              <option value="ajuste">Ajuste</option>
                          <option value="transferencia">Transferencia</option>
            </select>
            <div id="pc-adjust-kind-wrap" style="display:none; margin-top:6px">
              <label for="pc-mov-adjust-kind" class="muted" style="font-size:0.8rem">Modo ajuste</label>
              <select id="pc-mov-adjust-kind">
                <option value="faltante">Faltante</option>
                <option value="sobrante">Sobrante</option>
              </select>
            </div>
          
            <div id="pc-transfer-kind-wrap" style="display:none; margin-top:6px">
              <label for="pc-mov-transfer-kind" class="muted" style="font-size:0.8rem">Tipo de transferencia</label>
              <select id="pc-mov-transfer-kind">
                <option value="to_bank">A Banco</option>
                <option value="to_general">A Caja general</option>
                <option value="from_general">De Caja general</option>
              </select>
            </div>
</div>
          <div class="col">
            <label for="pc-mov-currency">Moneda</label>
            <select id="pc-mov-currency">
              <option value="NIO">C$</option>
              <option value="USD">US$</option>
            </select>
          </div>
          <div class="col">
            <label for="pc-mov-amount">Monto</label>
            <input id="pc-mov-amount" class="a33-num" data-a33-default="0.00" type="number" inputmode="decimal" min="0" step="0.01" value="0.00">
          </div>
          <div class="col">
            <label for="pc-mov-desc">Descripción</label>
            <input id="pc-mov-desc" type="text" placeholder="Detalle del movimiento">
          </div>
          <div class="col">
            <button id="pc-mov-add" class="btn-ok btn-pill">Agregar movimiento</button>
          </div>
        </div>

        <div class="row" style="margin-top:8px">
          <div class="col">
            <label for="pc-event-fx-rate">Tipo de cambio (USD → C$)</label>
            <input id="pc-event-fx-rate" type="number" inputmode="decimal" step="0.01" min="0" placeholder="C$ por 1 US$">
            <small class="muted">Se guarda por evento y se precarga automáticamente. Solo se exige si hoy hubo USD en Caja Chica.</small>
          </div>
          <div class="col" style="min-width:160px">
            <label>&nbsp;</label>
            <button id="pc-btn-save-event-fx" class="btn-primary btn-pill" type="button">Guardar T/C</button>
          </div>
        </div>

        <table class="pc-table" id="pc-mov-table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Moneda</th>
              <th>Monto</th>
              <th>Descripción</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="pc-mov-tbody">
          </tbody>
        </table>
      </div>
      </fieldset>
    
      <div class="card petty-final">
        <h3>Arqueo final</h3>
        

        <div class="actions" style="margin-top:8px">
  <button id="pc-btn-copy-initial" class="btn-primary btn-pill" type="button">Copiar Inicial</button>
</div>
        <small class="muted">Copia las cantidades del saldo inicial al arqueo final.</small>
<div class="row">
          <div class="petty-block">
            <h4>Córdobas (C$)</h4>
            <table class="pc-table" id="pc-table-fnio">
              <thead>
                <tr><th>Denominación</th><th>Cantidad</th><th>Subtotal</th></tr>
              </thead>
              <tbody>
                <tr><td>C$ 1</td><td><input id="pc-fnio-q-1" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-fnio-sub-1">0.00</span></td></tr>
                <tr><td>C$ 5</td><td><input id="pc-fnio-q-5" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-fnio-sub-5">0.00</span></td></tr>
                <tr><td>C$ 10</td><td><input id="pc-fnio-q-10" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-fnio-sub-10">0.00</span></td></tr>
                <tr><td>C$ 20</td><td><input id="pc-fnio-q-20" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-fnio-sub-20">0.00</span></td></tr>
                <tr><td>C$ 50</td><td><input id="pc-fnio-q-50" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-fnio-sub-50">0.00</span></td></tr>
                <tr><td>C$ 100</td><td><input id="pc-fnio-q-100" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-fnio-sub-100">0.00</span></td></tr>
                <tr><td>C$ 200</td><td><input id="pc-fnio-q-200" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-fnio-sub-200">0.00</span></td></tr>
                <tr><td>C$ 500</td><td><input id="pc-fnio-q-500" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-fnio-sub-500">0.00</span></td></tr>
                <tr><td>C$ 1000</td><td><input id="pc-fnio-q-1000" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>C$ <span id="pc-fnio-sub-1000">0.00</span></td></tr>
              </tbody>
              <tfoot>
                <tr><td colspan="2">Total final C$</td><td>C$ <span id="pc-fnio-total">0.00</span></td></tr>
              </tfoot>
            </table>
          </div>
          <div class="petty-block">
            <h4>Dólares (US$)</h4>
            <table class="pc-table" id="pc-table-fusd">
              <thead>
                <tr><th>Denominación</th><th>Cantidad</th><th>Subtotal</th></tr>
              </thead>
              <tbody>
                <tr><td>US$ 1</td><td><input id="pc-fusd-q-1" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-fusd-sub-1">0.00</span></td></tr>
                <tr><td>US$ 5</td><td><input id="pc-fusd-q-5" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-fusd-sub-5">0.00</span></td></tr>
                <tr><td>US$ 10</td><td><input id="pc-fusd-q-10" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-fusd-sub-10">0.00</span></td></tr>
                <tr><td>US$ 20</td><td><input id="pc-fusd-q-20" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-fusd-sub-20">0.00</span></td></tr>
                <tr><td>US$ 50</td><td><input id="pc-fusd-q-50" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-fusd-sub-50">0.00</span></td></tr>
                <tr><td>US$ 100</td><td><input id="pc-fusd-q-100" class="a33-num" data-a33-default="0" inputmode="numeric" type="number" min="0" step="1" value="0"></td><td>US$ <span id="pc-fusd-sub-100">0.00</span></td></tr>
              </tbody>
              <tfoot>
                <tr><td colspan="2">Total final US$</td><td>US$ <span id="pc-fusd-total">0.00</span></td></tr>
              </tfoot>
            </table>
          </div>
        </div>
        <div class="actions end">
  <button id="pc-btn-save-final" class="btn-ok btn-pill" type="button">Guardar arqueo final</button>
  <button id="pc-btn-clear-final" class="btn-danger btn-pill" type="button">Limpiar</button>
</div>
      </div>

      </fieldset>

      <div class="card petty-close">
        <h3>Cierre del día</h3>
        <div class="warn" style="margin-top:8px">
          El cierre del día se realiza desde <b>Resumen</b>.
          <button id="pc-btn-go-resumen" class="btn-primary btn-inline btn-pill" type="button" style="margin-left:8px">Ir a Resumen</button>
        </div>

        <div id="pc-close-status" class="info" style="margin-top:8px"></div>
        <div id="pc-close-blocker" class="warn" style="display:none; margin-top:8px"></div>
        <small class="muted">Tip: guarda el arqueo final y dejá la diferencia en 0 para poder cerrar desde Resumen.</small>
      </div>
</div>
  </section>

<section id="tab-resumen" class="tab card" style="display:none">
    <h2>Resumen</h2>
    <div class="summary-controls">
      <div class="summary-controls-left">
        <label>Período activo</label>
        <div class="row" style="gap:8px; align-items:center">
          <input id="summary-period" type="month">
          <button id="btn-summary-all" class="btn-link" type="button" title="Ver todo el historial">Todo</button>
          <span id="summary-mode-badge" class="tag small open">En vivo</span>
        </div>
        <small id="summary-period-hint" class="muted">Filtra el Resumen por mes. Puedes ver “Todo” cuando lo necesites.</small>
      </div>
	      <div class="summary-controls-right actions end">
	        <button id="btn-summary-export" class="btn-ok btn-pill" type="button">Exportar Excel</button>
	        <button id="btn-summary-close-period" class="btn-warn btn-pill" type="button">Cerrar período</button>
	        <!-- Archivo debe verse como botón (no como link) -->
	        <button id="btn-summary-archive" class="btn-outline" type="button" title="Ver períodos cerrados">Archivo</button>
	        <button id="btn-summary-back-live" class="btn-link" type="button" style="display:none">Volver a en vivo</button>
	      </div>
    </div>

    <!-- Cierre diario (snapshot oficial por evento + fecha) -->
    <div class="card" id="summary-daily-close-card">
      <div class="row" style="align-items:center; justify-content:space-between; gap:10px;">
        <div>
          <h3 style="margin:0;">Cierre diario</h3>
          <small class="muted">Guarda un snapshot por <b>evento + día</b>. Si Caja Chica está activa, el cierre exige arqueo final cuadrado.</small>
        </div>
        <span id="summary-close-status" class="pill">—</span>
      </div>
      <div class="row" style="align-items:flex-end; gap:10px; flex-wrap:wrap; margin-top:10px;">
        <div style="min-width:220px;">
	          <label class="muted" style="display:block; font-size:12px; margin-bottom:4px;" for="summary-close-event">Evento activo</label>
	          <select id="summary-close-event" aria-label="Evento activo">
	            <option value="">— Selecciona evento —</option>
	          </select>
        </div>
        <div>
          <label class="muted" style="display:block; font-size:12px; margin-bottom:4px;" for="summary-close-date">Fecha</label>
          <input id="summary-close-date" type="date">
        </div>
        <div class="actions" style="margin-left:auto; gap:8px; flex-wrap:wrap;">
          <button id="btn-summary-close-day" class="btn-danger btn-pill" type="button">Cerrar día</button>
          <button id="btn-summary-reopen-day" class="btn-pill" type="button">Reabrir día</button>
        </div>
      </div>
      <div id="summary-close-note" class="muted" style="margin-top:8px; display:none;"></div>
      <div id="summary-close-blocker" class="warn" style="display:none; margin-top:10px"></div>
    </div>

    <!-- Resumen · Cliente (filtro) -->
    <div class="card summary-customer-card">
      <div class="customer-v2">
        <div class="customer-v2-field">
          <label>Cliente <span class="muted">(opcional)</span></label>
          <input id="summary-customer" placeholder="Selecciona o escribe…">
          <small class="muted" id="summary-customer-hint">Filtra este resumen por cliente usando historial real.</small>
        </div>

        <div class="customer-v2-actions">
          <button id="btn-summary-customer-pick" class="btn-outline btn-pill btn-pill-mini" type="button">Seleccionar</button>
          <button id="btn-summary-customer-clear" class="btn-outline btn-pill btn-pill-mini" type="button">Limpiar</button>
          <span id="summary-customer-badge" class="tag small" style="margin-left:0">Sin filtro</span>
        </div>
      </div>
    </div>

    <div class="card summary-top">
      <div class="summary-metrics">
        <div class="metric">
          <div class="label">Total general</div>
          <div class="value">C$ <span id="grand-total">0</span></div>
        </div>
        <div class="metric">
          <div class="label">Costo estimado</div>
          <div class="value">C$ <span id="grand-cost">0</span></div>
        </div>
        <div class="metric">
          <div class="label">Utilidad bruta</div>
          <div class="value">C$ <span id="grand-profit">0</span></div>
        </div>
        <div class="metric">
          <div class="label">Cortesías (Costo real)</div>
          <div class="value">C$ <span id="grand-courtesy-cost">0</span></div>
        </div>
        <div class="metric metric-strong">
          <div class="label">Utilidad después de cortesías</div>
          <div class="value">C$ <span id="grand-profit-after-courtesy">0</span></div>
        </div>
      </div>
    </div>

    <!-- Resumen · Clientes (MVP) -->
    <div class="row">
      <div class="card customers-card full">
        <h3>Clientes</h3>

        <div class="customers-kpis">
          <div><b>Clientes únicos:</b> <span id="summary-customers-unique">0</span></div>
          <div><b>Ventas con cliente:</b> <span id="summary-sales-with-customer">0</span> <span class="muted">(<span id="summary-sales-with-customer-pct">0</span>%)</span></div>
        </div>

        <table id="tbl-top-clientes">
          <thead><tr><th>Cliente</th><th>Vendido</th><th>Compras</th></tr></thead>
          <tbody></tbody>
        </table>

        <div class="info"><small>Tip: toca un cliente del Top para filtrar todo el Resumen.</small></div>
      </div>
    </div>

    <div class="row">
      <div class="card">
        <h3>Por evento</h3>
        <table id="tbl-por-evento">
          <thead><tr><th>Evento</th><th>Total</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="card">
        <h3>Por día</h3>
        <table id="tbl-por-dia">
          <thead><tr><th>Fecha</th><th>Total</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <div class="row">
      <div class="card">
        <h3>Por producto</h3>
        <table id="tbl-por-prod">
          <thead><tr><th>Producto</th><th>Total</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="card">
        <h3>Por método de pago</h3>
        <table id="tbl-por-pago">
          <thead><tr><th>Método</th><th>Total</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>



    <div class="row">
      <div class="card full">
        <h3>Transferencias por banco</h3>
        <table id="tbl-transfer-bank">
          <thead><tr><th>Banco</th><th>Total</th><th>#</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  
    <div class="row">
      <div class="card courtesy-card full">
            <h3>Cortesías</h3>

            <div class="courtesy-kpis">
              <div><b>Costo real total:</b> C$ <span id="courtesy-total-cost">0</span></div>
              <div><b>Cantidad total:</b> <span id="courtesy-total-qty">0</span> <span class="muted">(unidades)</span></div>
              <div><b>Movimientos:</b> <span id="courtesy-total-tx">0</span></div>
              <div><b>Valor equivalente en ventas:</b> C$ <span id="courtesy-total-equiv">0</span></div>
            </div>

            <div class="table-scroll">
              <table id="tbl-courtesy-byprod">
                <thead><tr><th>Producto</th><th>Cant.</th><th>Costo total</th><th>Equivalente</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="info"><small>Nota: el “equivalente” es informativo (precio lista si existe). Arriba solo se refleja el impacto real en utilidad.</small></div>
          </div>
    
    </div>
</section>

  <section id="tab-productos" class="tab card" style="display:none">
    <h2>Productos</h2>

    <div class="card" id="extras-card">
      <h3>✨ Extras por evento</h3>
      <div class="info"><small>Para vender ítems ad-hoc (ej. <b>Charcutería</b>) sin crearlos en Inventario central. Estos extras son <b>solo del evento activo</b>.</small></div>

      <div class="row">
        <div>
          <label>Evento activo</label>
          <div id="extras-event-label" class="info-strong">—</div>
        </div>
        <div>
          <label>Alerta stock bajo (default)</label>
          <input id="extra-low-default" type="number" inputmode="numeric" step="1" min="0" value="5">
        </div>
      </div>

      <div class="row3">
        <div>
          <label>Nombre</label>
          <input id="extra-name" placeholder="Ej: Charcutería">
        </div>
        <div>
          <label>Cantidad (stock)</label>
          <input id="extra-stock" type="number" inputmode="numeric" step="1" min="0" placeholder="0">
        </div>
        <div>
          <label>Precio venta (C$)</label>
          <input id="extra-price" type="number" inputmode="decimal" step="0.01" min="0" placeholder="0">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Costo unitario (C$)</label>
          <input id="extra-cost" type="number" inputmode="decimal" step="0.01" min="0" placeholder="0">
        </div>
        <div>
          <label>Alerta stock bajo (este extra)</label>
          <input id="extra-low" type="number" inputmode="numeric" step="1" min="0" placeholder="5">
        </div>
      </div>

      <div class="actions end">
  <button id="btn-save-extra" class="btn-ok btn-pill">+ Agregar extra</button>
  <button id="btn-cancel-extra" class="btn-warn btn-pill" style="display:none">Cancelar edición</button>
</div>

      <div id="extras-list"></div>
      <div class="warn" id="extras-disabled-note" style="display:none"></div>
    </div>
    <div id="productos-list"></div>
    <div class="row">
      <input id="new-name" placeholder="Nombre">
      <input id="new-price" type="number" inputmode="decimal" step="0.01" placeholder="Precio">
    </div>
    <div class="actions end">
  <button id="btn-add-prod" class="btn-ok btn-pill">+ Agregar producto</button>
  <button id="btn-restore-seed" class="btn-warn btn-pill">Restaurar productos base (A33)</button>
</div>
    <div class="info"><small>Si por cualquier razón solo ves “Vaso”, usa el botón <b>Restaurar productos base (A33)</b>. No borra ventas.</small></div>

    <div class="card">
      <h3>Bancos</h3>
      <div id="banks-list"></div>
      <div class="row">
        <input id="bank-new-name" placeholder="Nombre del banco">
        <button id="btn-add-bank" class="btn-ok btn-pill">+ Agregar banco</button>
      </div>
      <div class="info"><small>Consejo: mejor <b>desactivar</b> bancos en lugar de borrarlos, para que el historial no quede huérfano.</small></div>
    </div>
  </section>

  <section id="tab-calculadora" class="tab card" style="display:none">
    <h2>Calculadora</h2>

    <div class="calc-grid">
      <div class="card inner calc-card">
        <div class="calc-display" aria-label="Pantalla de calculadora">
          <div id="calc-history" class="calc-history"></div>
          <div id="calc-output" class="calc-output">0</div>
        </div>

        <div class="calc-keys" id="calc-keys" aria-label="Teclado numérico">
          <button type="button" class="util" data-k="C">C</button>
          <button type="button" class="util" data-k="back">⌫</button>
          <button type="button" class="op" data-k="/">÷</button>
          <button type="button" class="op" data-k="*">×</button>

          <button type="button" data-k="7">7</button>
          <button type="button" data-k="8">8</button>
          <button type="button" data-k="9">9</button>
          <button type="button" class="op" data-k="-">−</button>

          <button type="button" data-k="4">4</button>
          <button type="button" data-k="5">5</button>
          <button type="button" data-k="6">6</button>
          <button type="button" class="op" data-k="+">+</button>

          <button type="button" data-k="1">1</button>
          <button type="button" data-k="2">2</button>
          <button type="button" data-k="3">3</button>
          <button type="button" class="eq" data-k="=">=</button>

          <button type="button" class="zero" data-k="0">0</button>
          <button type="button" data-k=".">.</button>
        </div>
      </div>

      <div class="card inner fx-card">
        <h3 style="margin-top:0">Conversor USD ↔ C$</h3>
        <div id="fx-meta" class="muted" style="margin-bottom:6px"></div>

        <div class="row">
          <div>
            <label for="fx-rate">Tipo de cambio (USD → C$)</label>
            <input id="fx-rate" type="number" inputmode="decimal" step="0.01" min="0" placeholder="C$ por 1 US$">
          </div>
          <div style="text-align:right">
            <label>&nbsp;</label>
            <button id="fx-refresh" class="btn-pill" type="button">Actualizar desde Caja Chica</button>
          </div>
        </div>

        <div id="fx-status" class="warn" style="display:none"></div>

        <div class="row">
          <div>
            <label for="fx-usd">Monto en US$</label>
            <input id="fx-usd" type="number" inputmode="decimal" step="0.01" placeholder="ej. 20">
          </div>
          <div>
            <label for="fx-nio">Monto en C$</label>
            <input id="fx-nio" type="number" inputmode="decimal" step="0.01" placeholder="ej. 740.00">
          </div>
        </div>

        <div class="fx-quick" aria-label="Botones rápidos USD">
          <span class="muted">Rápidos US$:</span>
          <button type="button" class="btn-mini fx-q" data-usd="1">1</button>
          <button type="button" class="btn-mini fx-q" data-usd="5">5</button>
          <button type="button" class="btn-mini fx-q" data-usd="10">10</button>
          <button type="button" class="btn-mini fx-q" data-usd="20">20</button>
          <button type="button" class="btn-mini fx-q" data-usd="50">50</button>
          <button type="button" class="btn-mini fx-q" data-usd="100">100</button>
          <button type="button" class="btn-mini fx-clear" id="fx-clear" title="Limpiar">Limpiar</button>
        </div>
      </div>
    </div>

    <div class="info" style="margin-top:10px">
      <small><b>Regla:</b> si Caja Chica ya tiene tipo de cambio, aquí se usa en <b>solo lectura</b>. Si no existe, puedes usar uno <b>temporal</b> solo en esta pantalla (no se guarda).</small>
    </div>
  </section>

  <section id="tab-checklist" class="tab card" style="display:none">
    <div class="row" style="justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
      <div>
        <h2 style="margin:0;">Checklist</h2>
        <div class="muted" style="margin-top:6px;">Tres fases: Pre-evento, Evento y Cierre. Editable por evento; checks + notas por día.</div>
      </div>
      <div class="row" style="margin:0; gap:8px; align-items:flex-end;">
        <div>
          <label for="checklist-event">Evento</label>
          <select id="checklist-event"></select>
        </div>
        <button id="checklist-go-events" class="btn-pill" type="button" title="Ir a Eventos">Eventos</button>
      </div>
    </div>

    <div id="checklist-empty" class="warn" style="display:none"></div>

    <div class="checklist-grid" id="checklist-grid" style="display:none">
      <div class="card inner">
        <div class="chk-head">
          <h3>PRE-EVENTO</h3>
          <button id="chk-add-pre" type="button" class="btn-mini chk-add" data-section="pre">+ Agregar ítem</button>
        </div>
        <div class="chk-list" id="chk-pre"></div>
      </div>

      <div class="card inner">
        <div class="chk-head">
          <h3>EVENTO</h3>
          <button id="chk-add-evento" type="button" class="btn-mini chk-add" data-section="evento">+ Agregar ítem</button>
        </div>
        <div class="chk-list" id="chk-evento"></div>
      </div>

      <div class="card inner">
        <div class="chk-head">
          <h3>CIERRE</h3>
          <button id="chk-add-cierre" type="button" class="btn-mini chk-add" data-section="cierre">+ Agregar ítem</button>
        </div>
        <div class="chk-list" id="chk-cierre"></div>
      </div>
    </div>

    <div class="card inner" style="margin-top:12px">
      <div class="row" style="justify-content:space-between; align-items:flex-end; gap:10px; flex-wrap:wrap;">
        <div style="flex:1; min-width:240px">
          <label for="checklist-notes">Notas del día</label>
          <textarea id="checklist-notes" rows="3" placeholder="Ej: llevar hielo extra, cables, cambio..."></textarea>
        </div>
        <div style="min-width:220px">
          <label>&nbsp;</label>
          <button id="checklist-reset-day" type="button" class="btn-warn btn-pill">Reiniciar checks del día</button>
          <div class="info"><small>Solo desmarca. No borra ítems.</small></div>
        </div>
      </div>
    </div>

    <div class="card inner" id="checklist-reminders-card" style="margin-top:12px">
      <div class="rem-head">
        <div>
          <h3 style="margin:0">RECORDATORIOS</h3>
          <div class="muted" style="margin-top:6px">Pendientes: <b><span id="checklist-reminder-count">0</span></b></div>
        </div>
        <div class="rem-head-meta muted" style="margin-left:auto">Hoy + Próximos 6 días</div>
      </div>

      <div class="rem-add" role="group" aria-label="Agregar recordatorio">
        <input id="checklist-reminder-text" class="rem-text" placeholder="Ej: llevar hielo, cables, cambio…">
        <input id="checklist-reminder-date" class="rem-date" type="date" title="Fecha (obligatoria)">
        <input id="checklist-reminder-due" class="rem-due" type="time" title="Hora (opcional)">
        <select id="checklist-reminder-priority" class="rem-priority" title="Prioridad (opcional)">
          <option value="">Prioridad</option>
          <option value="high">Alta</option>
          <option value="med">Media</option>
          <option value="low">Baja</option>
        </select>
        <button id="checklist-reminder-add" class="btn-ok btn-pill btn-pill-mini" type="button">Agregar</button>
      </div>

      <div id="checklist-reminder-list" class="rem-list" aria-label="Pendientes"></div>

      <div class="rem-done">
        <button id="checklist-reminder-done-toggle" class="btn-mini btn-pill btn-pill-mini" type="button" aria-expanded="false">Completados (0) ▾</button>
        <div id="checklist-reminder-done-wrap" class="rem-done-wrap" style="display:none">
          <div id="checklist-reminder-done-list" class="rem-list rem-list-done" aria-label="Completados"></div>
          <div class="actions end" style="margin-top:8px">
            <button id="checklist-reminder-clear-done" class="btn-warn btn-pill btn-pill-mini" type="button">Limpiar completados</button>
          </div>
        </div>
      </div>
    </div>
  </section>

</div>

<!-- Modal VER evento -->
<div id="event-view" class="modal">
  <div class="panel">
    <button id="ev-close" class="close btn-warn btn-pill">Cerrar</button>
    <h3 id="ev-title">Evento</h3>
    <div class="grid">
      <div class="card" id="ev-meta"></div>
      <div class="card" id="ev-totals"></div>
    </div>
    <div class="grid">
      <div class="card">
        <h4>Por día</h4>
        <table id="ev-byday"><thead><tr><th>Fecha</th><th>Total</th></tr></thead><tbody></tbody></table>
      </div>
      <div class="card">
        <h4>Por producto</h4>
        <table id="ev-byprod"><thead><tr><th>Producto</th><th>Total</th></tr></thead><tbody></tbody></table>
      </div>
    </div>
    <div class="card">
      <h4>Ventas</h4>
      <div class="scroll">
        <table id="ev-sales">
          <thead><tr><th>ID</th><th>Fecha</th><th>Hora</th><th>Producto</th><th>Cant</th><th>PU</th><th>Desc</th><th>Total</th><th>Pago</th><th>C</th><th>Dev</th><th>Cliente</th><th>Cortesía a</th><th>Notas</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- Modal Cerrar Período (Resumen) -->
<div id="summary-close-modal" class="modal">
  <div class="panel">
    <button id="summary-close-cancel" class="close btn-warn btn-pill">Cancelar</button>
    <h3>Cerrar período</h3>
    <div class="info"><small>Período: <b><span id="summary-close-period-label"></span></b></small></div>

    <div class="row">
      <input id="summary-close-name" placeholder="Nombre del cierre (ej: Diciembre 2025)">
    </div>

    <div class="actions end" style="gap:8px; margin-top:10px">
  <button id="summary-close-export" class="btn-ok btn-pill" type="button">Exportar Excel (obligatorio)</button>
  <button id="summary-close-confirm" class="btn-primary btn-pill" type="button" disabled>Cerrar y archivar</button>
</div>

    <div id="summary-close-error" class="warn" style="display:none; margin-top:10px"></div>
    <div id="summary-close-status" class="muted"></div>
    <div class="warn"><small>Regla: sin exportación no hay cierre. Así evitamos “ups… no hice backup”.</small></div>
  </div>
</div>

<!-- Modal Archivo de Resúmenes -->
<div id="summary-archive-modal" class="modal">
  <div class="panel">
    <button id="summary-archive-close" class="close btn-warn btn-pill">Cerrar</button>
    <h3>Archivo de Resúmenes</h3>

    <div class="row" style="gap:8px">
      <input id="summary-archive-search" placeholder="Buscar (ej: Diciembre 2025)">
      <button id="summary-archive-refresh" class="btn-pill" type="button">Actualizar</button>
    </div>

    <div class="scroll">
      <table id="tbl-summary-archives">
        <thead><tr><th style="width:70px">Seq</th><th>Período</th><th style="width:170px">Fecha cierre</th><th style="width:170px">Acciones</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="info"><small>Los archivos son snapshots (solo lectura). Puedes re-exportar Excel cuando quieras.</small></div>
  </div>
</div>




<!-- Modal Seleccionar Cliente (Clientes v2) -->
<div id="customer-picker-modal" class="modal">
  <div class="panel panel-compact">
    <button id="customer-picker-close" class="close btn-warn btn-pill btn-pill-mini" type="button">Cerrar</button>
    <h3>Seleccionar cliente</h3>

    <div class="row" style="grid-template-columns:1fr; gap:10px">
      <input id="customer-picker-search" placeholder="Buscar cliente…">
      <small id="customer-picker-count" class="muted"></small>
    </div>

    <div class="scroll" style="max-height:55vh">
      <div id="customer-picker-list" class="customer-picker-list"></div>
    </div>

    <div class="warn"><small>Solo se muestran clientes activos. Para ver desactivados o administrar, usa “Gestionar ▾”.</small></div>
  </div>
</div>

<!-- Modal Editar Cliente (Clientes v3) -->
<div id="customer-edit-modal" class="modal">
  <div class="panel panel-compact">
    <button id="customer-edit-close" class="close btn-warn btn-pill btn-pill-mini" type="button">Cerrar</button>
    <h3>Editar cliente</h3>

    <p class="hint small" id="customer-edit-current" style="margin-top:0.25rem;">Actual: —</p>

    <div class="row" style="grid-template-columns:1fr; gap:10px">
      <input id="customer-edit-name" placeholder="Nuevo nombre…" autocomplete="off">
      <input id="customer-edit-reason" placeholder="Motivo (opcional)…" autocomplete="off">
      <small id="customer-edit-msg" class="muted"></small>
    </div>

    <div class="row" style="grid-template-columns:1fr 1fr; gap:10px; margin-top:10px">
      <button id="customer-edit-save" class="btn-ok btn-pill" type="button">Guardar</button>
      <button id="customer-edit-cancel" class="btn-secondary btn-pill" type="button">Cancelar</button>
    </div>

    <div class="warn"><small>Editar cambia <b>solo</b> el nombre. El ID se mantiene y el historial no se reescribe.</small></div>
  </div>
</div>

<!-- Modal Fusionar Clientes (Clientes v3) -->
<div id="customer-merge-modal" class="modal">
  <div class="panel panel-compact">
    <button id="customer-merge-close" class="close btn-warn btn-pill btn-pill-mini" type="button">Cerrar</button>
    <h3>Fusionar clientes</h3>

    <div class="warn" style="margin-top:8px">
      <small><b>Advertencia:</b> Esto NO borra ventas históricas. La “Fuente” quedará desactivada y apuntará al “Destino”.</small>
    </div>

    <div class="grid" style="margin-top:10px">
      <div>
        <label class="muted" for="customer-merge-source">Fuente (se absorbe)</label>
        <select id="customer-merge-source"></select>
      </div>
      <div>
        <label class="muted" for="customer-merge-dest">Destino (se queda)</label>
        <select id="customer-merge-dest"></select>
      </div>
    </div>

    <div class="row" style="grid-template-columns:1fr; gap:10px; margin-top:10px">
      <input id="customer-merge-reason" placeholder="Motivo (opcional)…" autocomplete="off">
      <label class="muted" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <input id="customer-merge-confirm" type="checkbox"> Confirmo que entiendo y quiero fusionar.
      </label>
      <small id="customer-merge-msg" class="muted"></small>
    </div>

    <div class="row" style="grid-template-columns:1fr 1fr; gap:10px; margin-top:10px">
      <button id="customer-merge-run" class="btn-warn btn-pill" type="button">Fusionar</button>
      <button id="customer-merge-cancel" class="btn-secondary btn-pill" type="button">Cancelar</button>
    </div>

    <div class="info"><small>Consejo: si te equivocas, podés revertir creando una nueva identidad y fusionando de nuevo (no es ideal, pero mantiene trazabilidad).</small></div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">Hecho</div>
<footer></footer>
<nav class="tabbar">
  <button data-tab="venta" class="active">Vender</button>
  <button data-tab="inventario">Inventario</button>
  <button data-tab="eventos">Eventos</button>
  <button data-tab="caja">Caja Chica</button>
  <button data-tab="resumen">Resumen</button>
  <button data-tab="productos">Productos</button>
  <button data-tab="calculadora">Calculadora</button>
  <button data-tab="checklist">Checklist</button>
</nav>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="/assets/js/a33-storage.js"></script>
<script src="/assets/js/a33-auth.js"></script>
<script>
  if (!(A33Auth.isConfigured() && A33Auth.isAuthenticated())){
    location.href = "../index.html";
  }
</script>
<script src="app.js?v=4.20.5"></script>
<script src="/assets/js/a33-input-ux.js"></script>
<script>
  if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js?v=4.20.5'); }
</script>
</body>
</html>
