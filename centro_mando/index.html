<!doctype html>
<!-- Legacy redirect — no usar para desarrollo -->
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0b0b" />
  <meta http-equiv="refresh" content="4;url=../centro-mando/index.html" />
  <title>Centro de Mando — Actualizando…</title>
  <style>
    :root{color-scheme:dark}
    body{margin:0;background:#0b0b0b;color:#f2f2f2;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{width:min(560px,100%);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{font-size:18px;margin:0 0 8px}
    p{margin:0 0 10px;line-height:1.35;color:#cfcfcf;font-size:14px}
    .status{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;color:#caa85c;font-size:12px;white-space:pre-wrap}
    .hint{opacity:.85;margin-top:10px;font-size:12px}
    a{color:#caa85c}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Actualizando Centro de Mando…</h1>
      <p>Estamos moviendo el módulo a su ruta canónica para evitar versiones “zombie” por caché.</p>
      <div id="status" class="status">Iniciando…</div>
      <p class="hint">Si no te redirige, abrí <a href="../centro-mando/index.html">Centro de Mando</a>.</p>
    </div>
  </div>

  <script>
    (async () => {
      const statusEl = document.getElementById('status');
      const set = (m) => { try { statusEl.textContent = m; } catch(e) {} };

      const target = "../centro-mando/index.html";

      // 1) Intentar desregistrar SW bajo este scope (centro_mando)
      try {
        if ('serviceWorker' in navigator) {
          set("Desregistrando Service Workers…");
          const regs = await navigator.serviceWorker.getRegistrations();
          const scopeNeedle = "centro_mando";
          await Promise.all(regs
            .filter(r => (r && r.scope && String(r.scope).toLowerCase().includes(scopeNeedle)))
            .map(r => r.unregister().catch(() => false))
          );
        }
      } catch (e) {}

      // 2) Intentar limpiar caches relacionadas (sin asumir nombres exactos)
      try {
        if (window.caches && caches.keys) {
          set("Limpiando cachés relacionadas…");
          const keys = await caches.keys();
          const kill = keys.filter(k => {
            const s = String(k).toLowerCase();
            return s.includes("a33-centro") || s.includes("centro");
          });
          await Promise.all(kill.map(k => caches.delete(k).catch(() => false)));
        }
      } catch (e) {}

      // 3) Redirigir al canónico
      set("Redirigiendo…");
      try { location.replace(target); } catch (e) { location.href = target; }

      // Fallback por si algo raro ocurre
      setTimeout(() => {
        try {
          if (String(location.pathname).toLowerCase().includes("centro_mando")) location.href = target;
        } catch (e) {}
      }, 900);
    })();
  </script>
</body>
</html>
