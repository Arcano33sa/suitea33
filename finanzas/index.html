<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Finanzas – Suite A33</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body class="fin-body">
  <div class="fin-app">

    <!-- ENCABEZADO CON LOGO A33 -->
    <header class="fin-header">
  <div class="fin-header-left">
    <div class="fin-logo-wrapper">
      <!-- Logo Arcano 33 (mismo archivo que usa el menú principal) -->
      <img src="../icon-a33-192.png" alt="Arcano 33" class="fin-logo-img">
    </div>
    <div class="fin-title-block">
      <h1>Suite A33</h1>
      <p>Finanzas · Contabilidad básica de Arcano 33</p>
    </div>
  </div>

  <nav class="fin-main-nav">
    <div class="nav-group">
      <span class="nav-group-label">Suite A33</span>
      <a href="../index.html">Menú principal</a>
      <a href="../calculadora/index.html">Calculadora</a>
      <a href="../inventario/index.html">Inventario</a>
      <a href="../pos/index.html">A33 POS · Eventos</a>
      <a href="../pedidos/index.html">Planificación de Pedidos</a>
      <a href="../analitica/index.html">Analítica de Ventas</a>
      <a href="../lotes/index.html">Control de Lotes</a>
    </div>

    <div class="nav-group">
      <span class="nav-group-label">Finanzas</span>
      <button type="button" class="fin-tab-btn active" data-view="tablero">Tablero Finanzas</button>
      <button type="button" class="fin-tab-btn" data-view="diario">Diario y Ajustes</button>
      <button type="button" class="fin-tab-btn" data-view="cajachica">Caja Chica</button>
      <button type="button" class="fin-tab-btn" data-view="estados">Estados Financieros</button>
      <button type="button" class="fin-tab-btn" data-view="comprasplan">Compras</button>
      <button type="button" class="fin-tab-btn" data-view="compras">Compras a Proveedor</button>
      <button type="button" class="fin-tab-btn" data-view="proveedores">Proveedores</button>
      <button type="button" class="fin-tab-btn" data-view="catalogo">Catálogo de Cuentas</button>
    </div>
  </nav>
</header>

    <main class="fin-main">

      <!-- TABLERO FINANZAS -->
      <section id="view-tablero" class="fin-view active">
        <header class="fin-section-header">
          <h2>Tablero Finanzas</h2>
          <p>Resumen mensual de ingresos, costos, gastos y resultado. Puedes filtrar por evento.</p>
        </header>

        <div class="fin-filters-row">
          <label>
            Mes
            <select id="tab-mes"></select>
          </label>
          <label>
            Año
            <select id="tab-anio"></select>
          </label>
          <label>
            Evento
            <select id="tab-evento"></select>
          </label>
        </div>

        <div class="fin-cards-grid">
          <article class="fin-card">
            <h3>Ingresos (4xxx)</h3>
            <p id="tab-ingresos" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>COGS (5100)</h3>
            <p id="tab-costos" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>Cortesías (6105)</h3>
            <p id="tab-cortesias" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>Margen bruto del periodo</h3>
            <p id="tab-bruta" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>Utilidad después de cortesías</h3>
            <p id="tab-post-cortesias" class="fin-card-number">C$ 0.00</p>
          </article>
          <article class="fin-card">
            <h3>Gastos de operación (6xxx)</h3>
            <p id="tab-gastos" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card fin-card-strong">
            <h3>Resultado neto del periodo</h3>
            <p id="tab-resultado" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>Saldo Caja (1100 + 1110)</h3>
            <p id="tab-caja" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>Saldo Banco (1200)</h3>
            <p id="tab-banco" class="fin-card-number">C$ 0.00</p>
          </article>
        </div>

        <!-- Gráfico Ingresos / Costos / Resultado -->
        <section class="fin-subsection">
          <header class="fin-section-header fin-section-header--sub">
            <h3>Gráfico Ingresos / Costos / Resultado</h3>
            <p>
              Visualiza el comportamiento del periodo y evento seleccionados.
              Barras en colores de la Suite A33.
            </p>
          </header>
          <div class="fin-chart-wrapper">
            <canvas id="tab-chart" width="480" height="240"></canvas>
          </div>
        </section>
      </section>

      <!-- DIARIO Y AJUSTES -->
      <section id="view-diario" class="fin-view">
        <header class="fin-section-header">
          <h2>Diario y Ajustes</h2>
          <p>Registra ingresos, egresos y ajustes manuales. Por detrás se generan asientos DEBE/HABER.</p>
        </header>

        <div class="fin-filters-row fin-filters-row--compact">
          <label>
            Tipo
            <select id="filtro-tipo">
              <option value="todos">Todos</option>
              <option value="ingreso">Ingresos</option>
              <option value="egreso">Egresos</option>
              <option value="ajuste">Ajustes</option>
                          <option value="transferencia">Transferencias</option>
            </select>
          </label>

          <label>
            Evento
            <select id="filtro-evento-diario"></select>
          </label>

          <label>
            Origen
            <select id="filtro-origen">
              <option value="todos">Todos</option>
              <option value="Interno">Interno</option>
              <option value="POS">POS (todo)</option>
              <option value="POS_CIERRES">POS — Cierres diarios</option>
              <option value="POS_LEGACY">LEGACY — ventas individuales</option>
            </select>
          </label>

          <label>
            Proveedor
            <select id="filtro-proveedor"></select>
          </label>

          <label>
            Desde
            <input type="date" id="diario-desde">
          </label>

          <label>
            Hasta
            <input type="date" id="diario-hasta">
          </label>

          <div id="diario-presets" class="fin-presets">
            <button type="button" class="btn-small" data-diario-preset="hoy">Hoy</button>
            <button type="button" class="btn-small" data-diario-preset="ayer">Ayer</button>
            <button type="button" class="btn-small" data-diario-preset="7d">Últimos 7</button>
            <button type="button" class="btn-small" data-diario-preset="mes">Este mes</button>
            <button type="button" class="btn-small" data-diario-preset="todo">Todo</button>
          </div>
        </div>

        <form id="form-movimiento" class="fin-form">
          <div class="fin-form-row">
            <label>
              Fecha
              <input type="date" id="mov-fecha">
            </label>

            <label>
              Tipo de movimiento
              <select id="mov-tipo">
                <option value="ingreso">Ingreso</option>
                <option value="egreso">Egreso</option>
                <option value="ajuste">Ajuste</option>
                            <option value="transferencia">Transferencia</option>
            </select>
            </label>

            <label>
              Medio
              <select id="mov-medio">
                <option value="caja">Caja</option>
                <option value="banco">Banco</option>
              </select>
            </label>

            <label>
              Monto
              <input type="number" id="mov-monto" step="0.01" min="0">
            </label>
          </div>

          <div class="fin-form-row">
            <label class="fin-form-grow">
              Cuenta principal
              <select id="mov-cuenta"></select>
            </label>

            <label class="fin-form-grow">
              Evento
              <select id="mov-evento-sel"></select>
            </label>
          </div>

          <div class="fin-form-row">
            <label class="fin-form-grow">
              Referencia
              <input type="text" id="mov-evento" placeholder="Factura # / Referencia (opcional)">
            </label>
          </div>

          <div class="fin-form-row">
            <label class="fin-form-grow">
              Descripción
              <input type="text" id="mov-descripcion" placeholder="Descripción del movimiento">
            </label>

            <button type="button" id="mov-guardar" class="btn-primary">
              Guardar movimiento
            </button>
          </div>

          <p class="fin-help">
            En Fase 3A el asiento sigue siendo de dos líneas automáticas:
            <br>
            <strong>Ingreso:</strong> DEBE Caja/Banco · HABER Cuenta de ingreso seleccionada.<br>
            <strong>Egreso:</strong> DEBE Cuenta de gasto/costo · HABER Caja/Banco.<br>
            <strong>Ajuste simple:</strong> Caja/Banco contra la cuenta seleccionada.
          </p>
        </form>

        <div class="cc-actions" id="diario-actions-bar">
          <button type="button" id="btn-export-diario" class="fin-btn-export">Exportar Diario a Excel</button>
          <button type="button" id="btn-import-pos-closures" class="fin-btn-export">Importar cierres POS</button>
          <span id="import-pos-closures-msg" class="cc-msg"></span>
        </div>

        <div class="fin-table-wrapper">
          <table class="fin-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Descripción</th>
                <th>Tipo</th>
                <th>Evento / Ref</th>
                <th>Proveedor</th>
                <th>Origen</th>
                <th>Debe</th>
                <th>Haber</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="diario-tbody"></tbody>
          </table>
        </div>
      </section>

      

<!-- COMPRAS (PLANIFICACIÓN / HISTÓRICO, NO CONTABLE) -->
<section id="view-comprasplan" class="fin-view">
  <header class="fin-section-header">
    <h2>Compras</h2>
    <p>Planifica compras por hacer, guarda histórico y exporta a Excel. Esto es informativo: no genera asientos, no toca Diario.</p>
  </header>

  <section class="fin-subsection purchase-block">
    <header class="fin-section-header fin-section-header--sub purchase-header">
      <div>
        <h3>Compra Actual</h3>
        <p>Editor de compras por hacer. Guarda como borrador o envíalo al histórico.</p>
      </div>
      <div class="purchase-meta">
        <span id="pc-updated" class="cc-updated">Actualizado: —</span>
      </div>
    </header>

    <div class="purchase-actions">
      <button type="button" id="pc-save" class="btn-primary">Guardar</button>
      <button type="button" id="pc-save-history" class="btn-small">Guardar en Histórico</button>
      <button type="button" id="pc-delete-all" class="btn-danger">Borrar todo</button>
      <button type="button" id="pc-export" class="fin-btn-export">Exportar Excel</button>
      <span id="pc-msg" class="cc-msg"></span>
    </div>

    <div class="purchase-two">
      <article class="fin-card purchase-card">
        <div class="purchase-card-head">
          <h4>COMPRAS PROVEEDORES</h4>
          <button type="button" id="pc-add-proveedores" class="btn-small">+ Agregar línea</button>
        </div>
        <div id="pc-grid-proveedores" class="purchase-grid" aria-label="Compras Proveedores"></div>
        <div class="purchase-totals">
          <span>Total sección</span>
          <strong id="pc-total-proveedores">C$ 0.00</strong>
        </div>
      </article>

      <article class="fin-card purchase-card">
        <div class="purchase-card-head">
          <h4>COMPRAS VARIAS</h4>
          <button type="button" id="pc-add-varias" class="btn-small">+ Agregar línea</button>
        </div>
        <div id="pc-grid-varias" class="purchase-grid" aria-label="Compras Varias"></div>
        <div class="purchase-totals">
          <span>Total sección</span>
          <strong id="pc-total-varias">C$ 0.00</strong>
        </div>
      </article>
    </div>

    <div class="purchase-notes">
      <label for="pc-notes">Notas</label>
      <textarea id="pc-notes" rows="3" placeholder="Notas ligadas a la compra completa (opcional)"></textarea>
    </div>

    <div class="purchase-summary">
      <div class="purchase-summary-top">
        <div>
          <h4>Total General</h4>
          <p id="pc-total-general" class="fin-card-number">C$ 0.00</p>
        </div>
      </div>

      <div class="purchase-product-summary">
        <div class="purchase-card-head">
          <h4>Resumen por Producto</h4>
        </div>
        <div class="fin-table-wrapper">
          <table class="fin-table purchase-mini-table">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Cantidad total</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="pc-product-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <section class="fin-subsection purchase-block">
    <header class="fin-section-header fin-section-header--sub">
      <h3>Histórico de Compras</h3>
      <p>Snapshots de compras (informativo). Puedes ver, duplicar, exportar o eliminar.</p>
    </header>

    <div class="fin-filters-row fin-filters-row--compact">
      <label class="fin-form-grow">
        Buscar
        <input type="text" id="ph-search" placeholder="Proveedor, producto o notas…">
      </label>
      <button type="button" id="ph-clear" class="btn-small">Limpiar</button>
    </div>

    <div class="fin-table-wrapper">
      <table class="fin-table">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Notas</th>
            <th>Total</th>
            <th># Ítems</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="ph-tbody"></tbody>
      </table>
    </div>

    <p id="ph-help" class="fin-help"></p>
  </section>

  <div id="ph-modal" class="fin-modal">
    <div class="fin-modal-content">
      <header class="fin-modal-header">
        <h3>Detalle de compra</h3>
        <button type="button" id="ph-modal-close" class="btn-close">×</button>
      </header>
      <div class="fin-modal-body">
        <div id="ph-modal-meta" class="fin-detalle-meta"></div>

        <div class="purchase-notes purchase-notes--read">
          <label>Notas</label>
          <div id="ph-modal-notes" class="purchase-notes-read"></div>
        </div>

        <div class="purchase-modal-totals">
          <div><span>Proveedores</span> <strong id="ph-modal-total-proveedores">C$ 0.00</strong></div>
          <div><span>Varias</span> <strong id="ph-modal-total-varias">C$ 0.00</strong></div>
          <div class="strong"><span>Total</span> <strong id="ph-modal-total-general">C$ 0.00</strong></div>
        </div>

        <div class="purchase-modal-section">
          <h4>COMPRAS PROVEEDORES</h4>
          <div class="fin-table-wrapper">
            <table class="fin-table purchase-mini-table">
              <thead>
                <tr>
                  <th>Proveedor</th>
                  <th>Producto</th>
                  <th>Tipo</th>
                  <th>Cant.</th>
                  <th>Precio</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="ph-modal-tbody-proveedores"></tbody>
            </table>
          </div>
        </div>

        <div class="purchase-modal-section">
          <h4>COMPRAS VARIAS</h4>
          <div class="fin-table-wrapper">
            <table class="fin-table purchase-mini-table">
              <thead>
                <tr>
                  <th>Proveedor</th>
                  <th>Producto</th>
                  <th>Tipo</th>
                  <th>Cant.</th>
                  <th>Precio</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="ph-modal-tbody-varias"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- COMPRAS A PROVEEDOR -->
<section id="view-compras" class="fin-view">
  <header class="fin-section-header">
    <h2>Compras a Proveedor</h2>
    <p>Registra compras pagadas (sin deudas) y consulta un reporte rápido por proveedor.</p>
  </header>

  <form id="form-compra" class="fin-form">
    <div class="fin-form-row">
      <label class="fin-form-grow">
        Proveedor
        <select id="compra-proveedor"></select>
      </label>

      <label>
        Fecha
        <input type="date" id="compra-fecha">
      </label>

      <label>
        Tipo de compra
        <select id="compra-tipo">
          <option value="inventory">Compra a Inventario (Insumos)</option>
          <option value="expense">Gasto inmediato</option>
        </select>
      </label>

      <label>
        Pago
        <select id="compra-medio">
          <option value="cash">Caja</option>
          <option value="bank">Banco</option>
        </select>
      </label>

      <label>
        Monto
        <input type="number" id="compra-monto" step="0.01" min="0">
      </label>
    </div>

    <div class="fin-form-row">
      <label class="fin-form-grow">
        Cuenta DEBE
        <select id="compra-cuenta-debe"></select>
      </label>

      <label class="fin-form-grow">
        Cuenta HABER
        <select id="compra-cuenta-haber"></select>
      </label>
    </div>

    <div class="fin-form-row">
      <label class="fin-form-grow">
        Descripción / concepto
        <input type="text" id="compra-descripcion" placeholder="Ej: Vino tinto, vodka, jugo, etc.">
      </label>

      <label class="fin-form-grow">
        Referencia (factura/recibo)
        <input type="text" id="compra-referencia" placeholder="Opcional">
      </label>

      <button type="button" id="compra-guardar" class="btn-primary">
        Guardar compra
      </button>
    </div>

    <p class="fin-help">
      Aquí no existe “Proveedores por pagar”. Toda compra queda registrada como pagada al momento.
      Se guarda bajo <strong>General/Central</strong> (sin evento).
    </p>
  </form>

  <section class="fin-subsection">
    <header class="fin-section-header fin-section-header--sub">
      <h3>Reporte rápido: Compras por Proveedor</h3>
      <p>Filtra por mes o por rango de fechas. Totales por proveedor y desglose por método de pago.</p>
    </header>

    <div class="fin-filters-row fin-filters-row--compact">
      <label>
        Modo de periodo
        <select id="compras-modo">
          <option value="mes">Por mes</option>
          <option value="rango">Por rango</option>
        </select>
      </label>

      <div id="compras-filtros-mes" class="fin-inline-group">
        <label>
          Mes
          <select id="compras-mes"></select>
        </label>
        <label>
          Año
          <select id="compras-anio"></select>
        </label>
      </div>

      <div id="compras-filtros-rango" class="fin-inline-group hidden">
        <label>
          Desde
          <input type="date" id="compras-desde">
        </label>
        <label>
          Hasta
          <input type="date" id="compras-hasta">
        </label>
      </div>

      <label>
        Proveedor
        <select id="compras-proveedor"></select>
      </label>
    </div>

    <div class="fin-table-wrapper">
      <table class="fin-table">
        <thead>
          <tr>
            <th>Proveedor</th>
            <th># compras</th>
            <th>Total</th>
            <th>Caja</th>
            <th>Banco</th>
          </tr>
        </thead>
        <tbody id="compras-tbody"></tbody>
      </table>
    </div>

    <p id="compras-ayuda" class="fin-help"></p>
  </section>
</section>

<!-- PROVEEDORES -->
<section id="view-proveedores" class="fin-view">
  <header class="fin-section-header">
    <h2>Proveedores</h2>
    <p>Catálogo simple de proveedores. Sirve para filtrar el Diario y el reporte de compras.</p>
  </header>

  <form id="form-proveedor" class="fin-form">
    <input type="hidden" id="prov-id">

    <div class="fin-form-row">
      <label class="fin-form-grow">
        Nombre (obligatorio)
        <input type="text" id="prov-nombre" placeholder="Ej: Global Brand">
      </label>

      <label>
        Teléfono
        <input type="text" id="prov-telefono" placeholder="Opcional">
      </label>
    </div>

    <div class="fin-form-row">
      <label class="fin-form-grow">
        Nota
        <input type="text" id="prov-nota" placeholder="Opcional">
      </label>

      <div class="fin-actions">
        <button type="button" id="prov-guardar" class="btn-primary">Guardar proveedor</button>
        <button type="button" id="prov-cancelar" class="btn-ghost hidden">Cancelar</button>
      </div>
    </div>

    <p class="fin-help">
      Tip: aunque borres un proveedor del catálogo, las compras históricas se quedan con el nombre guardado en el asiento.
    </p>
  </form>

  <div class="fin-table-wrapper">
    <table class="fin-table">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Teléfono</th>
          <th>Nota</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="proveedores-tbody"></tbody>
    </table>
  </div>
</section>

<!-- CATÁLOGO DE CUENTAS -->
<section id="view-catalogo" class="fin-view">
  <header class="fin-section-header">
    <h2>Catálogo de Cuentas</h2>
    <p>Crea, edita y oculta cuentas sin afectar movimientos ya registrados.</p>
  </header>

  <div class="fin-filters-row fin-filters-row--compact fin-catalog-toolbar">
    <label class="fin-grow">
      Buscar (código o nombre)
      <input type="text" id="cat-search" placeholder="Ej: 4100, caja, ventas…" autocomplete="off">
    </label>

    <div class="fin-inline-group fin-catalog-actions">
      <button type="button" id="cat-new" class="btn-small">+ Nueva cuenta</button>
      <button type="button" id="cat-refresh" class="btn-small">Actualizar</button>
      <button type="button" id="cat-export" class="btn-small">Exportar Excel</button>
    </div>
  </div>

  <p id="cat-help" class="fin-help">
    Tip: Las cuentas protegidas no se editan ni se ocultan. Las cuentas ocultas siguen visibles aquí y en históricos.
  </p>

  <div class="fin-table-wrapper">
    <table class="fin-table fin-catalog-table" aria-label="Catálogo de cuentas">
      <thead>
        <tr>
          <th>Código</th>
          <th>Nombre</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>Protegida</th>
          <th>Usada</th>
          <th class="fin-actions-cell">Acciones</th>
        </tr>
      </thead>
      <tbody id="cat-tbody"></tbody>
    </table>
  </div>
</section>

<!-- MODAL: CREAR / EDITAR CUENTA -->
<div id="cat-modal" class="fin-modal" aria-hidden="true">
  <div class="fin-modal-content" role="dialog" aria-modal="true" aria-labelledby="cat-modal-title">
    <div class="fin-modal-header">
      <div>
        <strong id="cat-modal-title">Cuenta</strong>
        <div id="cat-modal-sub" class="fin-help" style="margin:2px 0 0"></div>
      </div>
      <button type="button" id="cat-modal-close" class="btn-close" aria-label="Cerrar">×</button>
    </div>
    <div class="fin-modal-body">
      <form id="cat-form" class="fin-form fin-form--inmodal" autocomplete="off">
        <input type="hidden" id="cat-mode" value="new">
        <input type="hidden" id="cat-edit-code" value="">

        <div class="fin-form-row">
          <label>
            Código (4 dígitos)
            <input type="text" id="cat-code" inputmode="numeric" pattern="\d{4}" placeholder="Ej: 4101">
          </label>

          <label class="fin-form-grow">
            Nombre
            <input type="text" id="cat-name" placeholder="Ej: Ingresos por comida">
          </label>
        </div>

        <div class="fin-form-row">
          <label>
            Tipo (rootType)
            <select id="cat-root"></select>
          </label>

          <div class="fin-actions">
            <button type="button" id="cat-save" class="btn-primary">Guardar</button>
            <button type="button" id="cat-cancel" class="btn-ghost">Cancelar</button>
          </div>
        </div>

        <p id="cat-form-msg" class="fin-help"></p>
      </form>
    </div>
  </div>
</div>

<!-- CAJA CHICA (FÍSICA / INFORMATIVA) -->
<section id="view-cajachica" class="fin-view">
  <header class="fin-section-header">
    <h2>Caja Chica</h2>
    <p>Conteo físico de efectivo por denominaciones (solo informativo). No genera asientos, no afecta la cuenta contable “Caja”.</p>
  </header>

  <div class="cc-topbar">
    <div class="cc-tabs" role="tablist" aria-label="Moneda">
      <button type="button" class="cc-tab active" data-currency="NIO" aria-selected="true">C$</button>
      <button type="button" class="cc-tab" data-currency="USD" aria-selected="false">USD</button>
    </div>
    <div class="cc-meta">
      <span id="cc-updated" class="cc-updated">Actualizado: —</span>
    </div>
  </div>

  <div class="fin-table-wrapper cc-table-wrap">
    <table class="fin-table cc-table" aria-label="Conteo Caja Chica">
      <thead>
        <tr>
          <th>Denominación</th>
          <th style="width:130px">Cantidad</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody id="cc-tbody"></tbody>
      <tfoot>
        <tr>
          <td colspan="2" id="cc-total-label">Total</td>
          <td><span id="cc-total-prefix">C$</span> <span id="cc-total-value">0.00</span></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="cc-actions">
    <button type="button" id="cc-save" class="btn-primary cc-btn">Guardar</button>
    <button type="button" id="cc-reset" class="btn-danger">Reset a cero</button>
    <button type="button" id="cc-recalc" class="btn-small">Recalcular</button>
    <span id="cc-msg" class="cc-msg"></span>
  </div>

  <p class="fin-help">Tip: este snapshot lo puede leer POS manualmente como saldo inicial cuando lo habilitas con “Sincronizar”.</p>
</section>

      <!-- ESTADOS FINANCIEROS -->
      <section id="view-estados" class="fin-view">
        <header class="fin-section-header">
          <h2>Estados Financieros</h2>
          <p>Estado de Resultados, Balance General y Flujo de Caja usando los asientos de Finanzas.</p>
        </header>

        <div class="fin-subtabs">
          <button type="button" class="fin-subtab-btn active" data-subview="er">Estado de Resultados</button>
          <button type="button" class="fin-subtab-btn" data-subview="bg">Balance General</button>
          <button type="button" class="fin-subtab-btn" data-subview="fc">Flujo de Caja</button>
        </div>

        <!-- Estado de Resultados -->
        <section id="sub-er" class="fin-subview active">
          <div class="fin-filters-row">
            <label>
              Modo de periodo
              <select id="er-modo">
                <option value="mes">Por mes</option>
                <option value="rango">Por rango de fechas</option>
              </select>
            </label>

            <div id="er-filtros-mes" class="fin-inline-group">
              <label>
                Mes
                <select id="er-mes"></select>
              </label>
              <label>
                Año
                <select id="er-anio"></select>
              </label>
            </div>

            <div id="er-filtros-rango" class="fin-inline-group hidden">
              <label>
                Desde
                <input type="date" id="er-desde">
              </label>
              <label>
                Hasta
                <input type="date" id="er-hasta">
              </label>
            </div>

            <label>
              Evento
              <select id="er-evento"></select>
            </label>
          </div>

          <div class="fin-cards-grid fin-cards-grid--er">
            <article class="fin-card">
              <h3>Ingresos (4xxx)</h3>
              <p id="er-ingresos" class="fin-card-number">C$ 0.00</p>
            </article>

            <article class="fin-card">
              <h3>COGS (5100)</h3>
              <p id="er-costos" class="fin-card-number">C$ 0.00</p>
            </article>

            <article class="fin-card">
              <h3>Gastos de operación (6xxx)</h3>
              <p id="er-gastos" class="fin-card-number">C$ 0.00</p>
            </article>

            <article class="fin-card fin-card-strong">
              <h3>Utilidad bruta</h3>
              <p id="er-bruta" class="fin-card-number">C$ 0.00</p>
            </article>

            <article class="fin-card fin-card-strong">
              <h3>Utilidad neta</h3>
              <p id="er-neta" class="fin-card-number">C$ 0.00</p>
            </article>
          </div>

          <!-- Exportar Estado de Resultados -->
          <button type="button" id="btn-export-er" class="fin-btn-export">
            Exportar Estado de Resultados a Excel
          </button>

          <p class="fin-help">
            Nota: en Fase 3A los costos (5xxx) se pueden registrar manualmente.
            En Fase 3B los costos de venta se generarán en automático desde el POS según presentaciones de Arcano 33.
          </p>

          <!-- Aquí, debajo, el JS inserta:
               - Rentabilidad por presentación
               - Comparativo de eventos
               con sus propios botones de exportar -->
        </section>

        <!-- Balance General -->
        <section id="sub-bg" class="fin-subview">
          <div class="fin-filters-row">
            <label>
              Fecha de corte
              <input type="date" id="bg-fecha">
            </label>
          </div>

          <div class="fin-table-wrapper">
            <table class="fin-table">
              <thead>
                <tr>
                  <th>Grupo</th>
                  <th>Saldo</th>
                </tr>
              </thead>
              <tbody id="bg-tbody">
                <tr>
                  <td>Activos (1xxx)</td>
                  <td id="bg-activos" class="num">C$ 0.00</td>
                </tr>
                <tr>
                  <td>Pasivos (2xxx)</td>
                  <td id="bg-pasivos" class="num">C$ 0.00</td>
                </tr>
                <tr>
                  <td>Patrimonio (3xxx)</td>
                  <td id="bg-patrimonio" class="num">C$ 0.00</td>
                </tr>
                <tr class="fin-row-strong">
                  <td>Activos – Pasivos – Patrimonio</td>
                  <td id="bg-cuadre" class="num">C$ 0.00</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Exportar Balance General -->
          <button type="button" id="btn-export-bg" class="fin-btn-export">
            Exportar Balance General a Excel
          </button>

          <p class="fin-help">
            Idealmente el Balance cuadra (Activos = Pasivos + Patrimonio).
            En esta Fase 3A solo se usan las cuentas 1xxx, 2xxx y 3xxx que entren en los asientos.
          </p>
        </section>

        <!-- Flujo de Caja -->
        <section id="sub-fc" class="fin-subview">
          <header class="fin-section-header fin-section-header--sub">
            <h3>Flujo de Caja simple</h3>
            <p>
              Usa el mismo periodo seleccionado en el Estado de Resultados (mes o rango).
              Calcula Caja + Banco: saldo inicial, entradas, salidas y saldo final,
              separando operación vs aportes/retiros del dueño.
            </p>
          </header>

          <div class="fin-table-wrapper">
            <table class="fin-table" id="fc-table">
              <thead>
                <tr>
                  <th>Concepto</th>
                  <th>Monto</th>
                </tr>
              </thead>
              <tbody id="fc-tbody">
                <tr>
                  <td colspan="2">Sin datos de efectivo para el periodo seleccionado.</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Exportar Flujo de Caja -->
          <button type="button" id="btn-export-fc" class="fin-btn-export">
            Exportar Flujo de Caja a Excel
          </button>
        </section>
      </section>
    </main>

    <!-- Toast -->
    <div id="toast" class="fin-toast"></div>

    <!-- Modal detalle de asiento -->
    <div id="detalle-modal" class="fin-modal">
      <div class="fin-modal-content">
        <header class="fin-modal-header">
          <h3>Detalle de asiento</h3>
          <button type="button" id="detalle-cerrar" class="btn-close">×</button>
        </header>
        <div class="fin-modal-body">
          <div id="detalle-meta" class="fin-detalle-meta"></div>
          <div class="fin-table-wrapper">
            <table class="fin-table">
              <thead>
                <tr>
                  <th>Cuenta</th>
                  <th>Nombre</th>
                  <th>Debe</th>
                  <th>Haber</th>
                </tr>
              </thead>
              <tbody id="detalle-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="/assets/js/a33-storage.js"></script>
  <script src="/assets/js/a33-auth.js"></script>
  <script>
    if (!(A33Auth.isConfigured() && A33Auth.isAuthenticated())){
      location.href = "../index.html";
    }
  </script>
  <script src="script.js"></script>
  <script src="/assets/js/a33-input-ux.js"></script>
</body>
</html>
