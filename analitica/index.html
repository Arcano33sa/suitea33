<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Arcano 33 ¬∑ Anal√≠tica</title>
  <meta name="description" content="Anal√≠tica interna de ventas por evento y presentaci√≥n para Arcano 33, solo lectura desde el POS." />
  <meta name="theme-color" content="#7b1818" />

  <link rel="icon" type="image/png" sizes="192x192" href="../inventario/images/logo.png" />
  <link rel="apple-touch-icon" href="../inventario/images/logo.png" />

  <!-- Brand fonts (optional; falls back gracefully if offline) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=EB+Garamond:wght@400;500;600&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="style.css" />
</head>
<body class="a33-analytics-page">
  <header class="app-header">
    <div class="brand">
      <img src="../inventario/images/logo.png" alt="Logo Arcano 33" class="logo" />
      <div class="brand-text">
        <h1>Arcano 33</h1>
        <p>Anal√≠tica ¬∑ Sangr√≠a Artesanal Premium</p>
      </div>
    </div>
  </header>

  <div class="top-actions">
    <a href="../index.html" class="btn-secondary">‚Üê Men√∫ principal</a>
  </div>

  <main class="app-main analytics-main">
    <section class="card analytics-panel">
      <div class="panel-head">
        <div>
          <h2>Anal√≠tica de Ventas</h2>
          <p class="hint">Visualiza el comportamiento de tus ventas por periodo, evento y presentaci√≥n. Esta vista es solo de lectura y utiliza los datos registrados en A33 POS en este mismo navegador.</p>
        </div>
      </div>

      <p id="analytics-error" class="hint error" style="display:none;">
        No se pudo leer la base de datos de ventas. Aseg√∫rate de haber utilizado antes el m√≥dulo A33 POS en este navegador.
      </p>

      <section class="analytics-filters">
        <div class="field">
          <label for="period-select">Periodo</label>
          <select id="period-select">
            <option value="today">Hoy</option>
            <option value="7d">√öltimos 7 d√≠as</option>
            <option value="30d">√öltimos 30 d√≠as</option>
            <option value="90d">√öltimos 3 meses</option>
            <option value="ytd">A√±o actual</option>
            <option value="all">Todo el hist√≥rico</option>
            <option value="custom">Rango personalizado</option>
          </select>
        </div>
        <div class="field field-inline" id="custom-range" style="display:none;">
          <label>Rango personalizado</label>
          <div class="range-inputs">
            <input type="date" id="date-from" />
            <span>‚Üí</span>
            <input type="date" id="date-to" />
          </div>
        </div>
      </section>

      <section class="analytics-tabs" aria-label="Pesta√±as de anal√≠tica">
        <button class="tab-btn active" data-tab="resumen" type="button">Resumen</button>
        <button class="tab-btn" data-tab="eventos" type="button">Eventos</button>
        <button class="tab-btn" data-tab="presentaciones" type="button">Presentaciones</button>
        <button class="tab-btn" data-tab="cortesias" type="button">Cortes√≠as</button>
        <button class="tab-btn" data-tab="avanzado" type="button">Avanzado</button>
      </section>

      <!-- TAB RESUMEN -->
      <section class="tab-content active" id="tab-resumen">
        <div class="kpi-grid">
          <article class="kpi-card">
            <p class="kpi-label">Ventas totales</p>
            <p class="kpi-value" id="kpi-total-ventas">C$ 0.00</p>
          </article>

          <article class="kpi-card">
            <p class="kpi-label">Botellas vendidas</p>
            <p class="kpi-value" id="kpi-total-botellas">0</p>
            <p class="kpi-sub" id="kpi-detalle-botellas">Pulso 0 ¬∑ Media 0 ¬∑ Djeba 0 ¬∑ Litro 0 ¬∑ Gal√≥n 0</p>
          </article>

          <article class="kpi-card">
            <p class="kpi-label">Eventos con ventas</p>
            <p class="kpi-value" id="kpi-eventos">0</p>
          </article>

          <article class="kpi-card">
            <p class="kpi-label">Ticket promedio</p>
            <p class="kpi-value" id="kpi-ticket-promedio">C$ 0.00</p>
          </article>

          <article class="kpi-card">
            <p class="kpi-label">Costo total</p>
            <p class="kpi-value" id="kpi-total-costo">C$ 0.00</p>
          </article>

          <article class="kpi-card">
            <p class="kpi-label">Utilidad total</p>
            <p class="kpi-value" id="kpi-total-utilidad">C$ 0.00</p>
          </article>

          <article class="kpi-card">
            <p class="kpi-label">Margen global</p>
            <p class="kpi-value" id="kpi-margen-global">0.0%</p>
          </article>

          <article class="kpi-card">
            <p class="kpi-label">Cortes√≠as (valor lista)</p>
            <p class="kpi-value" id="kpi-cortesias-total">C$ 0.00</p>
            <p class="kpi-sub" id="kpi-cortesias-sub">Unidades 0 ¬∑ Costo C$ 0.00</p>
            <p class="kpi-sub" id="kpi-cortesias-nivel">üü¢ Bajo (0.0%)</p>
          </article>
        </div>

        <div class="analytics-layout">
          <section class="card chart-card">
            <div class="card-head">
              <h3>Ventas por mes</h3>
            </div>
            <div class="chart-wrap">
              <canvas id="chart-mensual-ventas"></canvas>
            </div>
            <p class="hint small">Importe total de ventas netas por mes, considerando devoluciones y cortes√≠as.</p>
          </section>

          <div class="card table-card">
            <div class="card-head">
              <h3>Detalle mensual</h3>
            </div>
            <div class="table-wrapper">
              <table class="inv-table analytics-table">
                <thead>
                  <tr>
                    <th>Mes</th>
                    <th>Ventas (C$)</th>
                    <th>Costo (C$)</th>
                    <th>Utilidad (C$)</th>
                    <th>Margen %</th>
                    <th>Pulso</th>
                    <th>Media</th>
                    <th>Djeba</th>
                    <th>Litro</th>
                    <th>Gal√≥n</th>
                    <th># Eventos</th>
                    <th>Ticket prom.</th>
                    <th>Cortes√≠as (unid.)</th>
                    <th>Cortes√≠as valor (C$)</th>
                    <th>Cortes√≠as costo (C$)</th>
                    <th>Cortes√≠as %</th>
                  </tr>
                </thead>
                <tbody id="tbody-resumen-mensual"></tbody>
              </table>
            </div>
          </div>
        </div>

        <section class="card recs-card">
          <div class="card-head">
            <h3>Rentabilidad del periodo</h3>
          </div>
          <p class="hint small" id="kpi-top-contribucion">Mayor contribuci√≥n: ‚Äî</p>
          <p class="hint small" id="kpi-top-margen">Mejor margen: ‚Äî</p>
          <h4 class="recs-title">Recomendaciones r√°pidas</h4>
          <ul id="recs-rentabilidad" class="recs-list"></ul>
        </section>

        <div class="export-buttons">
          <button type="button" id="btn-export-resumen" class="btn-secondary">Exportar Excel ¬∑ Resumen</button>
        </div>
      </section>

      <!-- TAB EVENTOS -->
      <section class="tab-content" id="tab-eventos">
        <div class="tab-top">
          <p class="hint small">Ranking de eventos seg√∫n las ventas registradas en el periodo seleccionado.</p>

          <div class="field" style="max-width:240px;">
            <label for="orden-eventos">Ordenar por</label>
            <select id="orden-eventos">
              <option value="ventas">Ventas (C$)</option>
              <option value="botellas">Botellas</option>
              <option value="ticket">Ticket promedio</option>
              <option value="utilidad">Utilidad (C$)</option>
              <option value="margen">Margen %</option>
            </select>
          </div>
        </div>

        <div class="analytics-layout">
          <section class="card chart-card">
            <div class="card-head">
              <h3>Top eventos por ventas</h3>
            </div>
            <div class="chart-wrap chart-wrap--tall">
              <canvas id="chart-eventos-ventas"></canvas>
            </div>
            <p class="hint small">Solo se muestran los eventos con ventas dentro del periodo.</p>

            <hr class="chart-separator" />

            <div class="card-head">
              <h3>Top eventos por utilidad</h3>
            </div>
            <div class="chart-wrap chart-wrap--tall">
              <canvas id="chart-eventos-utilidad"></canvas>
            </div>
            <p class="hint small">Comparativo de utilidad total por evento en el periodo.</p>
          </section>

          <div class="card table-card">
            <div class="card-head">
              <h3>Detalle por evento</h3>
            </div>
            <div class="table-wrapper">
              <table class="inv-table analytics-table">
                <thead>
                  <tr>
                    <th>Evento</th>
                    <th>Estado</th>
                    <th>Ventas (C$)</th>
                    <th>Costo (C$)</th>
                    <th>Utilidad (C$)</th>
                    <th>Margen %</th>
                    <th>Botellas</th>
                    <th>Ticket prom.</th>
                    <th>% del total</th>
                    <th>Cortes√≠as (unid.)</th>
                    <th>Cortes√≠as valor (C$)</th>
                    <th>Cortes√≠as costo (C$)</th>
                    <th>Cortes√≠as %</th>
                    <th>Sem√°foro cortes√≠as</th>
                  </tr>
                </thead>
                <tbody id="tbody-eventos"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="export-buttons">
          <button type="button" id="btn-export-eventos" class="btn-secondary">Exportar Excel ¬∑ Eventos</button>
        </div>
      </section>

      <!-- TAB PRESENTACIONES -->
      <section class="tab-content" id="tab-presentaciones">
        <p class="hint small" style="margin-bottom:0.6rem;">
          Comparativo de rendimiento entre presentaciones de botella.
        </p>

        <div class="analytics-layout">
          <section class="card chart-card">
            <div class="card-head">
              <h3>Ventas por presentaci√≥n</h3>
            </div>
            <div class="chart-wrap">
              <canvas id="chart-pres-ventas"></canvas>
            </div>
            <p class="hint small">Incluye unidades vendidas y cortes√≠as; devoluciones restan del total.</p>

            <hr class="chart-separator" />

            <div class="card-head">
              <h3>Margen unitario por presentaci√≥n</h3>
            </div>
            <div class="chart-wrap">
              <canvas id="chart-pres-margen"></canvas>
            </div>
            <p class="hint small">Muestra el margen porcentual promedio por unidad en cada presentaci√≥n.</p>
          </section>

          <div class="card table-card">
            <div class="card-head">
              <h3>Detalle por presentaci√≥n</h3>
            </div>
            <div class="table-wrapper">
              <table class="inv-table analytics-table">
                <thead>
                  <tr>
                    <th>Presentaci√≥n</th>
                    <th>Unidades netas</th>
                    <th>Precio unitario prom. (C$)</th>
                    <th>Costo unitario estimado (C$)</th>
                    <th>Utilidad unitaria (C$)</th>
                    <th>Margen unitario %</th>
                    <th>Ventas totales (C$)</th>
                    <th>% de ventas</th>
                    <th>Cortes√≠as (unid.)</th>
                    <th>Cortes√≠as valor (C$)</th>
                    <th>Cortes√≠as costo (C$)</th>
                    <th>Cortes√≠as %</th>
                  </tr>
                </thead>
                <tbody id="tbody-presentaciones"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="export-buttons">
          <button type="button" id="btn-export-presentaciones" class="btn-secondary">Exportar Excel ¬∑ Presentaciones</button>
        </div>
      </section>

      <!-- TAB CORTES√çAS -->
      <section class="tab-content" id="tab-cortesias">
        <section class="card advanced-block">
          <div class="card-head">
            <h3>Listado de cortes√≠as</h3>
          </div>
          <p class="hint small" id="resumen-cortesias-top">
            Muestra todas las l√≠neas marcadas como cortes√≠a en el periodo seleccionado. Usa el filtro de evento para afinar el an√°lisis.
          </p>
          <div class="advanced-filters-row">
            <div class="field small">
              <label for="cortesias-event-select">Evento</label>
              <select id="cortesias-event-select">
                <option value="all">Todos los eventos</option>
              </select>
            </div>
          </div>
          <div class="table-wrapper">
            <table class="inv-table analytics-table">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Hora</th>
                  <th>Evento</th>
                  <th>Producto / presentaci√≥n</th>
                  <th>Cantidad</th>
                  <th>Destinatario</th>
                  <th>Valor lista (C$)</th>
                  <th>Costo estimado (C$)</th>
                  <th>Notas</th>
                </tr>
              </thead>
              <tbody id="tbody-cortesias"></tbody>
            </table>
          </div>
        </section>
      </section>

      <!-- TAB AVANZADO -->
      <section class="tab-content" id="tab-avanzado">
        <section class="card advanced-block">
          <div class="card-head">
            <h3>Horarios de venta (horas pico)</h3>
          </div>
          <p class="hint small">Identifica en qu√© horas se concentra la mayor parte de tus ventas en el rango seleccionado.</p>
          <div class="advanced-filters-row">
            <div class="field small">
              <label for="horas-event-select">Evento</label>
              <select id="horas-event-select">
                <option value="all">Todos los eventos</option>
              </select>
            </div>
          </div>

          <div class="chart-wrap">
            <canvas id="chart-horas-ventas"></canvas>
          </div>

          <p class="hint small" id="resumen-horas-pico">A√∫n no hay datos suficientes para este rango.</p>
          <div class="table-wrapper">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th>Hora</th>
                  <th>Ventas (C$)</th>
                  <th>Unidades netas</th>
                  <th>% de ventas</th>
                </tr>
              </thead>
              <tbody id="tbody-horas"></tbody>
            </table>
          </div>
        </section>

        <section class="card advanced-block">
          <div class="card-head">
            <h3>Riesgo de agotamiento (producto terminado)</h3>
          </div>
          <p class="hint small">Estimaci√≥n basada en ventas recientes y stock actual de botellas terminadas.</p>
          <div class="advanced-filters-row">
            <div class="field small">
              <label for="agotamiento-ventana">Ventana de an√°lisis</label>
              <select id="agotamiento-ventana">
                <option value="7">√öltimos 7 d√≠as</option>
                <option value="30" selected>√öltimos 30 d√≠as</option>
              </select>
            </div>
          </div>
          <div class="table-wrapper">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th>Presentaci√≥n</th>
                  <th>Stock actual (botellas)</th>
                  <th>Promedio u/d√≠a</th>
                  <th>D√≠as estimados</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody id="tbody-agotamiento"></tbody>
            </table>
          </div>
        </section>

        <section class="card advanced-block">
          <div class="card-head">
            <h3>Alertas y avisos del periodo</h3>
          </div>
          <p class="hint small">Sem√°foro basado en m√°rgenes, volumen y riesgo de agotamiento en el rango seleccionado.</p>
          <ul id="panel-alertas" class="alert-list"></ul>
        </section>

        <section class="card advanced-block">
          <div class="card-head">
            <h3>Proyecciones y reportes</h3>
          </div>
          <p class="hint small">Proyecciones simples basadas en el comportamiento del rango actual (no son estimaciones cient√≠ficas).</p>
          <p id="proy-resumen" class="hint"></p>
          <div class="table-wrapper">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th>Presentaci√≥n</th>
                  <th>Unidades/d√≠a (prom.)</th>
                  <th>Unidades proyectadas (30 d√≠as)</th>
                  <th>Ventas proyectadas (30 d√≠as)</th>
                </tr>
              </thead>
              <tbody id="tbody-proyecciones-pres"></tbody>
            </table>
          </div>
        </section>
      </section>

    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
